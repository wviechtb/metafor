<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit Regression Model based on a Correlation Matrix — matreg • metafor</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit Regression Model based on a Correlation Matrix — matreg" />
<meta property="og:description" content="Function to fit a regression model based on a correlation matrix. " />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metafor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.5-36</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/metafor-package.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/pkgdown/diagram.html">Diagram</a>
</li>
<li>
  <a href="https://www.jstatsoft.org/index.php/jss/article/view/v036i03/v36i03.pdf">JSS Article (pdf)</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/wviechtb">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/wviechtb/metafor">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit Regression Model based on a Correlation Matrix</h1>
    
    <div class="hidden name"><code>matreg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function to fit a regression model based on a correlation matrix. <script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script></p>
    </div>

    <pre class="usage"><span class='fu'>matreg</span>(<span class='no'>y</span>, <span class='no'>x</span>, <span class='no'>R</span>, <span class='no'>n</span>, <span class='no'>V</span>, <span class='kw'>nearPD</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>level</span><span class='kw'>=</span><span class='fl'>95</span>, <span class='no'>digits</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>y</th>
      <td><p>index of the outcome variable.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>indices of the predictor variable(s).</p></td>
    </tr>
    <tr>
      <th>R</th>
      <td><p>correlation matrix (or only the lower triangular part including the diagonal).</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>sample size based on which the elements in the correlation matrix were computed.</p></td>
    </tr>
    <tr>
      <th>V</th>
      <td><p>variance-covariance matrix of the lower triangular elements of the correlation matrix. Either <code>V</code> or <code>n</code> should be specified, not both. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>nearPD</th>
      <td><p>logical indicating whether the <code><a href='https://rdrr.io/pkg/Matrix/man/nearPD.html'>nearPD</a></code> function from the <code>Matrix</code> package should be used when the \(R_{x,x}\) matrix cannot be inverted. See &#8216;Note&#8217;.</p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>numerical value between 0 and 100 specifying the confidence interval level (the default is 95).</p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>integer specifying the number of decimal places to which the printed results should be rounded (if unspecified, the default is 4).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function can be used to fit a regression model based on a correlation matrix.</p>
<p>Let \(R\) be a \(p \times p\) correlation matrix. Let \(y\) denote the row/column of the outcome variable and \(x\) the row(s)/column(s) of the predictor variable(s). Let \(R_{x,x}\) and \(R_{x,y}\) denote the corresponding submatrices of \(R\). Then \[b = R_{x,x}^{-1} R_{x,y}\] yields the (standardized) regression slopes when regressing the outcome variable on the predictor variable(s).</p>
<p>The \(R\) matrix may be computed based on a single sample of \(n\) subjects. In this case, one should specify the sample size via argument <code>n</code>. The variance-covariance matrix of the estimated model coefficients is then given by \(\mbox{Var}[b] = \mbox{MSE} \times R_{x,x}^{-1}\), where \(\mbox{MSE} = (1 - b'R_{x,y}) / (n - m)\), where \(m\) denotes the number of predictor variables. The standard errors of the estimated model coefficients are then given by the square root of the diagonal elements of \(\mbox{Var}[b]\). Test statistics (in this case, t-statistics) and the corresponding p-values can then be computed as in regular regression.</p>
<p>Alternatively, \(R\) may be the result of a meta-analysis of correlation coefficients. In this case, the elements in \(R\) are really pooled correlation coefficients and there should be a variance-covariance matrix of these pooled coefficients. In this case, one should specify this variance-covariance matrix via argument <code>V</code>. The order of elements in <code>V</code> should correspond to the order of elements in the lower triangular part of \(R\) column-wise. For example, if \(R\) is a \(4 \times 4\) matrix, then the elements are \(r_{2,1}\), \(r_{3,1}\), \(r_{4,1}\), \(r_{3,2}\), \(r_{4,2}\), and \(r_{4,3}\) and hence <code>V</code> should be a \(6 \times 6\) variance-covariance matrix of these elements. The variance-covariance matrix of the estimated model coefficients (i.e., \(\mbox{Var}[b]\)) is then computed as described in Becker (1992) using the multivariate delta method. The standard errors of the estimated model coefficients are then given by the square root of the diagonal elements of \(\mbox{Var}[b]\). Test statistics (in this case, z-statistics) and the corresponding p-values can then be computed in the usual manner.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>"matreg"</code>. The object is a list containing the following components:</p>
<dt>tab</dt><dd><p>a data frame with the estimated model coefficients, standard errors, test statistics, p-values, and lower/upper confidence interval bounds.</p></dd>
   <dt>vb</dt><dd><p>the variance-covariance matrix of the estimated model coefficients.</p></dd>
   <dt>...</dt><dd><p>some additional elements/values.</p></dd>

   The results are formatted and printed with the print.matreg function.

    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Only the lower triangular part of <code>R</code> is used in the computations.</p>
<p>If \(R_{x,x}\) is not invertible, an error will be issued. In this case, one can set argument <code>nearPD=TRUE</code>, in which case the <code><a href='https://rdrr.io/pkg/Matrix/man/nearPD.html'>nearPD</a></code> function from the <code>Matrix</code> package will be used to find the nearest positive semi-definite matrix, which should be invertible. The results should be treated with caution when this is done.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Becker, B. J. (1992). Using results from replicated studies to estimate linear models. <em>Journal of Educational Statistics</em>, <b>17</b>(4), 341--362. <a href='https://doi.org/10.3102/10769986017004341'>https://doi.org/10.3102/10769986017004341</a></p>
<p>Becker, B. J. (1995). Corrections to "Using results from replicated studies to estimate linear models". <em>Journal of Educational and Behavioral Statistics</em>, <b>20</b>(1), 100--102. <a href='https://doi.org/10.3102/10769986020001100'>https://doi.org/10.3102/10769986020001100</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='rcalc.html'>rcalc</a></code>, <code><a href='rma.mv.html'>rma.mv</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>### copy data into 'dat'</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>dat.craft2003</span>

<span class='co'>### construct dataset and var-cov matrix of the correlations</span>
<span class='no'>tmp</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rcalc.html'>rcalc</a></span>(<span class='no'>ri</span> ~ <span class='no'>var1</span> + <span class='no'>var2</span> <span class='kw'>|</span> <span class='no'>study</span>, <span class='kw'>ni</span><span class='kw'>=</span><span class='no'>ni</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>)
<span class='no'>V</span> <span class='kw'>&lt;-</span> <span class='no'>tmp</span>$<span class='no'>V</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>tmp</span>$<span class='no'>dat</span>

<span class='co'>### turn var1.var2 into a factor with the desired order of levels</span>
<span class='no'>dat</span>$<span class='no'>var1.var2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>dat</span>$<span class='no'>var1.var2</span>,
   <span class='kw'>levels</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"acog.perf"</span>, <span class='st'>"asom.perf"</span>, <span class='st'>"conf.perf"</span>, <span class='st'>"acog.asom"</span>, <span class='st'>"acog.conf"</span>, <span class='st'>"asom.conf"</span>))

<span class='co'>### multivariate random-effects model</span>
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rma.mv.html'>rma.mv</a></span>(<span class='no'>yi</span>, <span class='no'>V</span>, <span class='kw'>mods</span> <span class='kw'>=</span> ~ <span class='no'>var1.var2</span> - <span class='fl'>1</span>, <span class='kw'>random</span> <span class='kw'>=</span> ~ <span class='no'>var1.var2</span> <span class='kw'>|</span> <span class='no'>study</span>, <span class='kw'>struct</span><span class='kw'>=</span><span class='st'>"UN"</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: Rows with NAs omitted from model fitting.</span></div><div class='input'><span class='no'>res</span></div><div class='output co'>#&gt; 
#&gt; Multivariate Meta-Analysis Model (k = 51; method: REML)
#&gt; 
#&gt; Variance Components:
#&gt; 
#&gt; outer factor: study     (nlvls = 9)
#&gt; inner factor: var1.var2 (nlvls = 6)
#&gt; 
#&gt;             estim    sqrt  k.lvl  fixed      level 
#&gt; tau^2.1    0.1611  0.4014      9     no  acog.perf 
#&gt; tau^2.2    0.0604  0.2459      9     no  asom.perf 
#&gt; tau^2.3    0.0468  0.2163      8     no  conf.perf 
#&gt; tau^2.4    0.0047  0.0683      9     no  acog.asom 
#&gt; tau^2.5    0.0125  0.1119      8     no  acog.conf 
#&gt; tau^2.6    0.0111  0.1052      8     no  asom.conf 
#&gt; 
#&gt;            rho.acg.p  rho.asm.p  rho.cnf.  rho.acg.s  rho.acg.c  rho.asm.c 
#&gt; acog.perf          1     0.9497   -0.6178     0.5491     0.0432     0.3532   
#&gt; asom.perf     0.9497          1   -0.5969     0.4604    -0.0495     0.2688   
#&gt; conf.perf    -0.6178    -0.5969         1    -0.9345     0.7023    -0.1311   
#&gt; acog.asom     0.5491     0.4604   -0.9345          1    -0.6961    -0.0891   
#&gt; acog.conf     0.0432    -0.0495    0.7023    -0.6961          1     0.4193   
#&gt; asom.conf     0.3532     0.2688   -0.1311    -0.0891     0.4193          1   
#&gt;            acg.p  asm.p  cnf.  acg.s  acg.c  asm.c 
#&gt; acog.perf      -     no    no     no     no     no 
#&gt; asom.perf      9      -    no     no     no     no 
#&gt; conf.perf      8      8     -     no     no     no 
#&gt; acog.asom      9      9     8      -     no     no 
#&gt; acog.conf      8      8     8      8      -     no 
#&gt; asom.conf      8      8     8      8      8      - 
#&gt; 
#&gt; Test for Residual Heterogeneity:
#&gt; QE(df = 45) = 334.8358, p-val &lt; .0001
#&gt; 
#&gt; Test of Moderators (coefficients 1:6):
#&gt; QM(df = 6) = 596.7703, p-val &lt; .0001
#&gt; 
#&gt; Model Results:
#&gt; 
#&gt;                     estimate      se     zval    pval    ci.lb    ci.ub 
#&gt; var1.var2acog.perf   -0.0600  0.1408  -0.4264  0.6698  -0.3359   0.2159      
#&gt; var1.var2asom.perf   -0.1423  0.0917  -1.5527  0.1205  -0.3220   0.0373      
#&gt; var1.var2conf.perf    0.3167  0.0847   3.7393  0.0002   0.1507   0.4827  *** 
#&gt; var1.var2acog.asom    0.5671  0.0367  15.4640  &lt;.0001   0.4953   0.6390  *** 
#&gt; var1.var2acog.conf   -0.4888  0.0509  -9.6047  &lt;.0001  -0.5886  -0.3891  *** 
#&gt; var1.var2asom.conf   -0.4750  0.0506  -9.3901  &lt;.0001  -0.5741  -0.3758  *** 
#&gt; 
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; </div><div class='input'>
<span class='co'>### restructure estimated mean correlations into a 4x4 matrix</span>
<span class='no'>R</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>NA</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>4</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>4</span>)
<span class='no'>R</span>[<span class='fu'><a href='https://rdrr.io/r/base/lower.tri.html'>lower.tri</a></span>(<span class='no'>R</span>)] <span class='kw'>&lt;-</span> <span class='fu'><a href='coef.rma.html'>coef</a></span>(<span class='no'>res</span>)
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>R</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>R</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"perf"</span>, <span class='st'>"acog"</span>, <span class='st'>"asom"</span>, <span class='st'>"conf"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span>(<span class='no'>R</span>, <span class='kw'>digits</span><span class='kw'>=</span><span class='fl'>3</span>)</div><div class='output co'>#&gt;        perf   acog   asom conf
#&gt; perf     NA     NA     NA   NA
#&gt; acog -0.060     NA     NA   NA
#&gt; asom -0.142  0.567     NA   NA
#&gt; conf  0.317 -0.489 -0.475   NA</div><div class='input'>
<span class='co'>### check that order in vcov(res) corresponds to order in R</span>
<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span>(<span class='fu'><a href='vcov.rma.html'>vcov</a></span>(<span class='no'>res</span>), <span class='kw'>digits</span><span class='kw'>=</span><span class='fl'>4</span>)</div><div class='output co'>#&gt;                    var1.var2acog.perf var1.var2asom.perf var1.var2conf.perf
#&gt; var1.var2acog.perf             0.0198             0.0115            -0.0069
#&gt; var1.var2asom.perf             0.0115             0.0084            -0.0043
#&gt; var1.var2conf.perf            -0.0069            -0.0043             0.0072
#&gt; var1.var2acog.asom             0.0017             0.0009            -0.0017
#&gt; var1.var2acog.conf             0.0004            -0.0002             0.0023
#&gt; var1.var2asom.conf             0.0018             0.0010            -0.0004
#&gt;                    var1.var2acog.asom var1.var2acog.conf var1.var2asom.conf
#&gt; var1.var2acog.perf             0.0017             0.0004             0.0018
#&gt; var1.var2asom.perf             0.0009            -0.0002             0.0010
#&gt; var1.var2conf.perf            -0.0017             0.0023            -0.0004
#&gt; var1.var2acog.asom             0.0013            -0.0009            -0.0004
#&gt; var1.var2acog.conf            -0.0009             0.0026             0.0011
#&gt; var1.var2asom.conf            -0.0004             0.0011             0.0026</div><div class='input'>
<span class='co'>### fit regression model with 'perf' as outcome and 'acog', 'asom', and 'conf' as predictors</span>
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>matreg</span>(<span class='fl'>1</span>, <span class='fl'>2</span>:<span class='fl'>4</span>, <span class='kw'>R</span><span class='kw'>=</span><span class='no'>R</span>, <span class='kw'>V</span><span class='kw'>=</span><span class='fu'><a href='vcov.rma.html'>vcov</a></span>(<span class='no'>res</span>))
<span class='no'>fit</span></div><div class='output co'>#&gt; 
#&gt;       estimate      se     zval    pval    ci.lb   ci.ub 
#&gt; acog    0.1482  0.1566   0.9465  0.3439  -0.1587  0.4550      
#&gt; asom   -0.0536  0.0768  -0.6979  0.4852  -0.2043  0.0970      
#&gt; conf    0.3637  0.0910   3.9985  0.0001   0.1854  0.5419  *** 
#&gt; 
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Wolfgang Viechtbauer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


