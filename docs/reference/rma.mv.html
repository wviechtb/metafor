<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. -->
<meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script>

<title>Meta-Analysis via Multivariate/Multilevel Linear (Mixed-Effects) Models — rma.mv • metafor</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- Flatly Theme - Light  -->
<link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">

<!-- Darkly Theme - Dark -->
<link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">

<!-- preferably CSS -->
<link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">

  <script src="../darkswitch.js"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Meta-Analysis via Multivariate/Multilevel Linear (Mixed-Effects) Models — rma.mv" />
<meta property="og:description" content="Function to fit meta-analytic multivariate/multilevel fixed- and random/mixed-effects models with or without moderators via linear (mixed-effects) models. See below and the documentation of the metafor-package for more details on these models. " />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@wviechtb" />
<meta name="twitter:site" content="@wviechtb" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>




<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metafor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.5-97</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/metafor-package.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/pkgdown/diagram.html">Diagram</a>
</li>
<li>
  <a href="https://www.jstatsoft.org/index.php/jss/article/view/v036i03/v36i03.pdf">JSS Article (pdf)</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
        <li>
          <a href="#" id="css-toggle-btn">
            <span class="fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        <li>
  <a href="https://twitter.com/wviechtb">
    <span class="fas fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/wviechtb/metafor">
    <span class="fas fa-github"></span>
     
  </a>
</li>
        
        


      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Meta-Analysis via Multivariate/Multilevel Linear (Mixed-Effects) Models</h1>
    
    <div class="hidden name"><code>rma.mv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function to fit meta-analytic multivariate/multilevel fixed- and random/mixed-effects models with or without moderators via linear (mixed-effects) models. See below and the documentation of the <span class="pkg"><a href='metafor-package.html'>metafor-package</a></span> for more details on these models. <script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script></p>
    </div>

    <pre class="usage"><span class='fu'>rma.mv</span><span class='op'>(</span><span class='va'>yi</span>, <span class='va'>V</span>, <span class='va'>W</span>, <span class='va'>mods</span>, <span class='va'>random</span>, struct<span class='op'>=</span><span class='st'>"CS"</span>, intercept<span class='op'>=</span><span class='cn'>TRUE</span>,
       <span class='va'>data</span>, <span class='va'>slab</span>, <span class='va'>subset</span>, method<span class='op'>=</span><span class='st'>"REML"</span>, test<span class='op'>=</span><span class='st'>"z"</span>, dfs<span class='op'>=</span><span class='st'>"residual"</span>,
       level<span class='op'>=</span><span class='fl'>95</span>, <span class='va'>digits</span>, <span class='va'>btt</span>, <span class='va'>R</span>, Rscale<span class='op'>=</span><span class='st'>"cor"</span>,
       <span class='va'>sigma2</span>, <span class='va'>tau2</span>, <span class='va'>rho</span>, <span class='va'>gamma2</span>, <span class='va'>phi</span>, sparse<span class='op'>=</span><span class='cn'>FALSE</span>, verbose<span class='op'>=</span><span class='cn'>FALSE</span>, <span class='va'>control</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>yi</th>
      <td><p>vector of length \(k\) with the observed effect sizes or outcomes. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>V</th>
      <td><p>vector of length \(k\) with the corresponding sampling variances or a \(k \times k\) variance-covariance matrix of the sampling errors. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>W</th>
      <td><p>optional argument to specify a vector of length \(k\) with user-defined weights or a \(k \times k\) user-defined weight matrix. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>mods</th>
      <td><p>optional argument to include one or more moderators in the model. A single moderator can be given as a vector of length \(k\) specifying the values of the moderator. Multiple moderators are specified by giving a matrix with \(k\) rows and as many columns as there are moderator variables. Alternatively, a model <code><a href='formula.rma.html'>formula</a></code> can be used to specify the model. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>random</th>
      <td><p>either a single one-sided formula or list of one-sided formulas to specify the random-effects structure of the model. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>struct</th>
      <td><p>character string to specify the variance structure of an <code>~ inner | outer</code> formula in the <code>random</code> argument. Either <code>"CS"</code> for compound symmetry, <code>"HCS"</code> for heteroscedastic compound symmetry, <code>"UN"</code> for an unstructured variance-covariance matrix, <code>"ID"</code> for a scaled identity matrix, <code>"DIAG"</code> for a diagonal matrix, <code>"AR"</code> for an AR(1) autoregressive structure, <code>"HAR"</code> for a heteroscedastic AR(1) autoregressive structure, <code>"CAR"</code> for a continuous-time autoregressive structure, or one of <code>"SPEXP"</code>, <code>"SPGAU"</code>, <code>"SPLIN"</code>, <code>"SPRAT"</code>, or <code>"SPSPH"</code> for one of the spatial correlation structures. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>intercept</th>
      <td><p>logical to specify whether an intercept should be added to the model (the default is <code>TRUE</code>). Ignored when <code>mods</code> is a formula.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>optional data frame containing the data supplied to the function.</p></td>
    </tr>
    <tr>
      <th>slab</th>
      <td><p>optional vector with labels for the \(k\) outcomes/studies.</p></td>
    </tr>
    <tr>
      <th>subset</th>
      <td><p>optional (logical or numeric) vector to specify the subset of studies (or more precisely, rows of the dataset) that should be used for the analysis.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>character string to specify whether the model should be fitted via maximum-likelihood (<code>"ML"</code>) or via restricted maximum-likelihood (<code>"REML"</code>) estimation. Default is <code>"REML"</code>.</p></td>
    </tr>
    <tr>
      <th>test</th>
      <td><p>character string to specify how test statistics and confidence intervals for the fixed effects should be computed. By default (<code>test="z"</code>), Wald-type tests and CIs are obtained, which are based on a standard normal distribution. When <code>test="t"</code>, a t-distribution is used instead. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>dfs</th>
      <td><p>character string to specify how the (denominator) degrees of freedom should be calculated when <code>test="t"</code>. Either <code>dfs="residual"</code> or <code>dfs="contain"</code>. Can also be a numeric vector with the degrees of freedom for each model coefficient. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>numeric value between 0 and 100 to specify the confidence interval level (the default is 95).</p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>integer to specify the number of decimal places to which the printed results should be rounded. If unspecified, the default is 4.</p></td>
    </tr>
    <tr>
      <th>btt</th>
      <td><p>optional vector of indices to specify which coefficients to include in the omnibus test of moderators. Can also be a string to grep for. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>R</th>
      <td><p>an optional named list of known correlation matrices corresponding to (some of) the components specified via the <code>random</code> argument. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>Rscale</th>
      <td><p>character string, integer, or logical to specify how matrices specified via the <code>R</code> argument should be scaled. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>sigma2</th>
      <td><p>optional numeric vector (of the same length as the number of random intercept components specified via the <code>random</code> argument) to fix the corresponding \(\sigma^2\) value(s). A specific \(\sigma^2\) value can be fixed by setting the corresponding element of this argument to the desired value. A specific \(\sigma^2\) value will be estimated if the corresponding element is set equal to <code>NA</code>. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>tau2</th>
      <td><p>optional numeric value (for <code>struct="CS"</code>, <code>"AR"</code>, <code>"CAR"</code>, or a spatial correlation structure) or vector (for <code>struct="HCS"</code>, <code>"UN"</code>, or <code>"HAR"</code>) to fix the amount of (residual) heterogeneity for the levels of the inner factor corresponding to an <code>~ inner | outer</code> formula specified in the <code>random</code> argument. A numeric value fixes a particular \(\tau^2\) value, while <code>NA</code> means that the value should be estimated. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>rho</th>
      <td><p>optional numeric value (for <code>struct="CS"</code>, <code>"HCS"</code>, <code>"AR"</code>, <code>"HAR"</code>, <code>"CAR"</code>, or a spatial correlation structure) or vector (for <code>struct="UN"</code>) to fix the correlation between the levels of the inner factor corresponding to an <code>~ inner | outer</code> formula specified in the <code>random</code> argument. A numeric value fixes a particular \(\rho\) value, while <code>NA</code> means that the value should be estimated. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>gamma2</th>
      <td><p>as <code>tau2</code> argument, but for a second <code>~ inner | outer</code> formula specified in the <code>random</code> argument. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>phi</th>
      <td><p>as <code>rho</code> argument, but for a second <code>~ inner | outer</code> formula specified in the <code>random</code> argument. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>sparse</th>
      <td><p>logical to specify whether the function should use sparse matrix objects to the extent possible (can speed up model fitting substantially for certain models). See &#8216;Note&#8217;.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical to specify whether output should be generated on the progress of the model fitting (the default is <code>FALSE</code>). Can also be an integer. Values &gt; 1 generate more verbose output. See &#8216;Note&#8217;.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>optional list of control values for the estimation algorithms. If unspecified, default values are defined inside the function. See &#8216;Note&#8217;.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<p><b>Specifying the Data</b></p>
<p>The function can be used in conjunction with any of the usual effect size or outcome measures used in meta-analyses (e.g., log risk ratios, log odds ratios, risk differences, mean differences, standardized mean differences, log transformed ratios of means, raw correlation coefficients, correlation coefficients transformed with Fisher's r-to-z transformation, and so on). Simply specify the observed effect sizes or outcomes via the <code>yi</code> argument and the corresponding sampling variances via the <code>V</code> argument. In case the sampling errors are correlated, then one can specify the entire variance-covariance matrix of the sampling errors via the <code>V</code> argument.</p>
<p>The <code><a href='escalc.html'>escalc</a></code> function can be used to compute a wide variety of effect size or outcome measures (and the corresponding sampling variances) based on summary statistics. Equations for computing the covariance between the sampling errors for a variety of different effect size or outcome measures can be found, for example, in Gleser and Olkin (2009). For raw and Fisher r-to-z transformed correlations, one can find suitable equations, for example, in Steiger (1980). The latter are implemented in the <code><a href='rcalc.html'>rcalc</a></code> function.</p>
<p><b>Specifying Fixed Effects</b></p>
<p>With <code>rma.mv(yi, V)</code>, a fixed-effects model is fitted to the data (note: arguments <code>struct</code>, <code>sigma2</code>, <code>tau2</code>, <code>rho</code>, <code>gamma2</code>, <code>phi</code>, <code>R</code>, and <code>Rscale</code> are not relevant then and are ignored). The model is then simply given by \(y \sim N(\theta, V)\), where \(y\) is a (column) vector with the observed outcomes, \(\theta\) is the (average) true outcome, and \(V\) is the variance-covariance matrix of the sampling errors (if a vector of sampling variances is provided via the <code>V</code> argument, then \(V\) is assumed to be diagonal).</p>
<p>One or more moderators can be included in the model via the <code>mods</code> argument. A single moderator can be given as a (row or column) vector of length \(k\) specifying the values of the moderator. Multiple moderators are specified by giving an appropriate model matrix (i.e., \(X\)) with \(k\) rows and as many columns as there are moderator variables (e.g., <code>mods = cbind(mod1, mod2, mod3)</code>, where <code>mod1</code>, <code>mod2</code>, and <code>mod3</code> correspond to the names of the variables for the three moderator variables). The intercept is added to the model matrix by default unless <code>intercept=FALSE</code>.</p>
<p>Alternatively, one can use standard <code><a href='formula.rma.html'>formula</a></code> syntax to specify the model. In this case, the <code>mods</code> argument should be set equal to a one-sided formula of the form <code>mods = ~ model</code> (e.g., <code>mods = ~ mod1 + mod2 + mod3</code>). Interactions, polynomial terms, and factors can be easily added to the model in this manner. When specifying a model formula via the <code>mods</code> argument, the <code>intercept</code> argument is ignored. Instead, the inclusion/exclusion of the intercept is controlled by the specified formula (e.g., <code>mods = ~ mod1 + mod2 + mod3 - 1</code> would lead to the removal of the intercept). One can also directly specify moderators via the <code>yi</code> argument (e.g., <code>rma.mv(yi ~ mod1 + mod2 + mod3, V)</code>). In that case, the <code>mods</code> argument is ignored and the inclusion/exclusion of the intercept again is controlled by the specified formula.</p>
<p>With moderators included, the model is then given by \(y \sim N(X \beta, V)\), where \(X\) denotes the model matrix containing the moderator values (and possibly the intercept) and \(\beta\) is a column vector containing the corresponding model coefficients. The model coefficients (i.e., \(\beta\)) are then estimated with \(b = (X'WX')^{-1} X'Wy\), where \(W = V^{-1}\) is the weight matrix (without moderators, \(X\) is just a column vector of 1's). With the <code>W</code> argument, one can also specify user-defined weights (or a weight matrix).</p>
<p><b>Specifying Random Effects</b></p>
<p>One can fit random/mixed-effects models to the data by specifying the desired random effects structure via the <code>random</code> argument. The <code>random</code> argument is either a single one-sided formula or a list of one-sided formulas. One formula type that can be specified via this argument is of the form <code>random = ~ 1 | id</code>. Such a formula adds a random effect corresponding to the grouping variable/factor <code>id</code> to the model. Outcomes with the same value/level of the <code>id</code> variable/factor receive the same value of the random effect, while outcomes with different values/levels of the <code>id</code> variable/factor are assumed to be independent. The variance component corresponding to such a formula is denoted by \(\sigma^2\). An arbitrary number of such formulas can be specified as a list of formulas (e.g., <code>random = list(~ 1 | id1, ~ 1 | id2)</code>), with variance components \(\sigma^2_1\), \(\sigma^2_2\), and so on. Nested random effects of this form can also be added using <code>random = ~ 1 | id1/id2</code>, which adds a random effect corresponding to the grouping variable/factor <code>id1</code> and a random effect corresponding to <code>id2</code> within <code>id1</code> to the model. This can be extended to models with even more levels of nesting (e.g., <code>random = ~ 1 | id1/id2/id2</code>).</p>
<p>Random effects of this form are useful to model clustering (and hence non-independence) induced by a multilevel structure in the data (e.g., outcomes derived from the same paper, lab, research group, or species may be more similar to each other than outcomes derived from different papers, labs, research groups, or species). See, for example, Konstantopoulos (2011) and Nakagawa and Santos (2012) for more details.</p>
<p>See <code><a href='dat.konstantopoulos2011.html'>dat.konstantopoulos2011</a></code>, <code><a href='dat.bornmann2007.html'>dat.bornmann2007</a></code>, <code><a href='dat.obrien2003.html'>dat.obrien2003</a></code>, and <code><a href='dat.crede2010.html'>dat.crede2010</a></code> for examples of multilevel meta-analyses.</p>
<p>In addition or alternatively to specifying one or multiple <code>~ 1 | id</code> terms, the <code>random</code> argument can also contain a formula of the form <code>~ inner | outer</code>. Outcomes with the same value/level of the <code>outer</code> grouping variable/factor share correlated random effects corresponding to the levels of the <code>inner</code> grouping variable/factor, while outcomes with different values/levels of the <code>outer</code> grouping variable/factor are assumed to be independent (note that the <code>inner</code> grouping variable must either be a factor or a character variable). The <code>struct</code> argument is used to specify the variance structure corresponding to the <code>inner</code> variable/factor. With <code>struct="CS"</code>, a compound symmetric structure is assumed (i.e., a single variance component \(\tau^2\) corresponding to all values/levels of the <code>inner</code> variable/factor and a single correlation coefficient \(\rho\) for the correlation between the different values/levels). With <code>struct="HCS"</code>, a heteroscedastic compound symmetric structure is assumed (with variance components \(\tau^2_1\), \(\tau^2_2\), and so on, corresponding to the values/levels of the <code>inner</code> variable/factor and a single correlation coefficient \(\rho\) for the correlation between the different values/levels). With <code>struct="UN"</code>, an unstructured variance-covariance matrix is assumed (with variance components \(\tau^2_1\), \(\tau^2_2\), and so on, corresponding to the values/levels of the <code>inner</code> variable/factor and correlation coefficients \(\rho_{12}\), \(\rho_{13}\), \(\rho_{23}\), and so on, for the various combinations of the values/levels of the <code>inner</code> variable/factor).</p>
<p><img src='figures/structs1.png' width=700 /></p>
<p>Structures <code>struct="ID"</code> and <code>struct="DIAG"</code> are just like <code>struct="CS"</code> and <code>struct="HCS"</code>, respectively, except that \(\rho\) is automatically set to 0, so that we either get a scaled identity matrix or a diagonal matrix.</p>
<p>With the <code>outer</code> factor corresponding to a study identification variable and the <code>inner</code> factor corresponding to a variable indicating the treatment type or study arm, such a random effect could be used to estimate how strongly different treatment effects or outcomes within the same study are correlated and/or whether the amount of heterogeneity differs across different treatment types/arms. Network meta-analyses (also known as mixed treatment comparisons) will also typically require such a random effect (e.g., Salanti et al., 2008). The meta-analytic bivariate model (e.g., van Houwelingen, Arends, &amp; Stijnen, 2002) can also be fitted in this manner (see the examples below). The <code>inner</code> factor could also correspond to a variable indicating different types of outcomes measured within the same study, which allows for fitting multivariate models with multiple correlated effects/outcomes per study (e.g., Berkey et al., 1998; Kalaian &amp; Raudenbush, 1996).</p>
<p>See <code><a href='dat.berkey1998.html'>dat.berkey1998</a></code>, <code><a href='dat.assink2016.html'>dat.assink2016</a></code>, <code><a href='dat.kalaian1996.html'>dat.kalaian1996</a></code>, <code><a href='dat.dagostino1998.html'>dat.dagostino1998</a></code>, and <code><a href='dat.craft2003.html'>dat.craft2003</a></code> for examples of multivariate meta-analyses with multiple outcomes. See <code><a href='dat.kearon1998.html'>dat.kearon1998</a></code> for an example using a bivariate model to analyze sensitivity and specificity. See <code><a href='dat.hasselblad1998.html'>dat.hasselblad1998</a></code>, <code><a href='dat.pagliaro1992.html'>dat.pagliaro1992</a></code>, <code><a href='dat.lopez2019.html'>dat.lopez2019</a></code>, and <code><a href='dat.senn2013.html'>dat.senn2013</a></code> for examples of network meta-analyses.</p>
<p>For meta-analyses of studies reporting outcomes at multiple time points, it may also be reasonable to assume that the true effects/outcomes are correlated over time according to an autoregressive structure (Ishak et al., 2007; Trikalinos &amp; Olkin, 2012). For this purpose, one can also choose <code>struct="AR"</code>, corresponding to a structure with a single variance component \(\tau^2\) and AR(1) autocorrelation among the values of the random effect. The values of the <code>inner</code> variable (which does not have to be a factor here) should then reflect the various time points, with increasing values reflecting later time points. This structure assumes equally spaced time points, so the actual values of the <code>inner</code> variable are not relevant, only their ordering. One can also use <code>struct="HAR"</code>, which allows for fitting a heteroscedastic AR(1) structure (with variance components \(\tau^2_1\), \(\tau^2_2\), and so on). Finally, when time points are not evenly spaced, one might consider using <code>struct="CAR"</code> for a continuous-time autoregressive structure.</p>
<p><img src='figures/structs2.png' width=700 /></p>
<p>See <code><a href='dat.fine1993.html'>dat.fine1993</a></code> and <code><a href='dat.ishak2007.html'>dat.ishak2007</a></code> for examples involving such structures.</p>
<p>For outcomes that have a known spatial configuration, various spatial correlation structures are also available. For these structures, the formula is of the form <code>random = ~ var1 + var2 + ... | outer</code>, where <code>var1</code>, <code>var2</code>, and so on are variables to indicate the spatial coordinates (e.g., longitude and latitude) based on which distances (by default Euclidean) will be computed. Let \(d\) denote the distance between two points that share the same level of the <code>outer</code> variable (if all true effects/outcomes are allowed to be spatially correlated, simply set <code>outer</code> to a variable that is a constant). Then the correlation between the true effects/outcomes corresponding to these two points is a function of \(d\) and the parameter \(\rho\). The following table shows the types of spatial correlation structures that can be specified and the equations for the correlation. The covariance between the true effects/outcomes is then the correlation times \(\tau^2\).</p>
<p></p><table class='table'>
<tr><td>structure</td><td>&emsp;</td><td><code>struct</code></td><td>&emsp;</td><td>correlation</td></tr>
<tr><td>exponential</td><td>&emsp;</td><td><code>"SPEXP"</code></td><td>&emsp;</td><td>\(\exp(-d/\rho)\)</td></tr>
<tr><td>Gaussian</td><td>&emsp;</td><td><code>"SPGAU"</code></td><td>&emsp;</td><td>\(\exp(-d^2/\rho^2)\)</td></tr>
<tr><td>linear</td><td>&emsp;</td><td><code>"SPLIN"</code></td><td>&emsp;</td><td>\((1 - d/\rho) I(d < \rho)\)</td></tr>
<tr><td>rational quadratic</td><td>&emsp;</td><td><code>"SPRAT"</code></td><td>&emsp;</td><td>\(1 - (d/\rho)^2 / (1 + (d/\rho)^2)\)</td></tr>
<tr><td>spherical</td><td>&emsp;</td><td><code>"SPSPH"</code></td><td>&emsp;</td><td>\((1 - 1.5(d/\rho) + 0.5(d/\rho)^3) I(d < \rho)\)</td></tr>
</table>
<p>Note that \(I(d < \rho)\) is equal to \(1\) if \(d < \rho\) and \(0\) otherwise. The parameterization of the various structures is based on Pinheiro and Bates (2000). Instead of Euclidean distances, one can also use other distance measures by setting (the undocumented) argument <code>dist</code> to either <code>"maximum"</code> for the maximum distance between two points (supremum norm), to <code>"manhattan"</code> for the absolute distance between the coordinate vectors (L1 norm), or to <code>"gcd"</code> for the great-circle distance (WGS84 ellipsoid method). In the latter case, only two variables, namely the longitude and latitude (in decimal degrees, with minus signs for West and South), must be specified.</p>
<p>If a distance matrix has already been computed, one can also pass this matrix as a list element to the <code>dist</code> argument. In this case, one should use a formula of the form <code>random = ~ id | outer</code>, where <code>id</code> are location identifiers, with corresponding row/column names in the distance matrix specified via the <code>dist</code> argument.</p>
<p>See <code><a href='dat.maire2019.html'>dat.maire2019</a></code> for an example of a meta-analysis with a spatial correlation structure.</p>
<p>The <code>random</code> argument can also contain a second formula of the form <code>~ inner | outer</code> (but no more!). A second formula of this form works exactly described as above, but its variance components are denoted by \(\gamma^2\) and its correlation components by \(\phi\). The <code>struct</code> argument should then be of length 2 to specify the variance-covariance structure for the first and second component, respectively.</p>
<p>When the <code>random</code> argument contains a formula of the form <code>~ 1 | id</code>, one can use the (optional) argument <code>R</code> to specify a corresponding known correlation matrix for the random effect (i.e., <code>R = list(id = Cor)</code>, where <code>Cor</code> is the correlation matrix). In that case, outcomes with the same value/level of the <code>id</code> variable/factor receive the same value for the random effect, while outcomes with different values/levels of the <code>id</code> variable/factor receive values that are correlated as specified in the corresponding correlation matrix given via the <code>R</code> argument. The column/row names of the correlation matrix given via the <code>R</code> argument must therefore contain all of the values/levels of the <code>id</code> variable/factor. When the <code>random</code> argument contains multiple formulas of the form <code>~ 1 | id</code>, one can specify known correlation matrices for none, some, or all of those terms (e.g., with <code>random = list(~ 1 | id1, ~ 1 | id2)</code>, one could specify <code>R = list(id1 = Cor1)</code> or <code>R = list(id1 = Cor1, id2 = Cor2)</code>, where <code>Cor1</code> and <code>Cor2</code> are the correlation matrices corresponding to the grouping variables/factors <code>id1</code> and <code>id2</code>, respectively).</p>
<p>Such a random effect with a known (or at least approximately known) correlation structure is useful in a variety of contexts. For example, such a component can be used to account for the correlations induced by the shared phylogenetic history among organisms (e.g., plants, fungi, animals). In that case, <code>~ 1 | species</code> is used to specify the species and argument <code>R</code> is used to specify the phylogenetic correlation matrix of the species studied in the meta-analysis. The corresponding variance component then indicates how much variance/heterogeneity is attributable to the specified phylogeny. See Nakagawa and Santos (2012) for more details. As another example, in a genetic meta-analysis studying disease association for several single nucleotide polymorphisms (SNPs), linkage disequilibrium (LD) among the SNPs can induce an approximately known degree of correlation among the effects/outcomes. In that case, <code>~ 1 | snp</code> could be used to specify the SNPs and <code>R</code> the corresponding LD correlation matrix for the SNPs included in the meta-analysis.</p>
<p>The <code>Rscale</code> argument controls how matrices specified via the <code>R</code> argument are scaled. With <code>Rscale="none"</code> (or <code>Rscale=0</code> or <code>Rscale=FALSE</code>), no scaling is used. With <code>Rscale="cor"</code> (or <code>Rscale=1</code> or <code>Rscale=TRUE</code>), the <code><a href='https://rdrr.io/r/stats/cor.html'>cov2cor</a></code> function is used to ensure that the matrices are correlation matrices (assuming they were covariance matrices to begin with). With <code>Rscale="cor0"</code> (or <code>Rscale=2</code>), first <code><a href='https://rdrr.io/r/stats/cor.html'>cov2cor</a></code> is used and then the elements of each correlation matrix are scaled with \((R - \min(R)) / (1 - \min(R))\) (this ensures that a correlation of zero in a phylogenetic correlation matrix corresponds to the split at the root node of the tree comprising the species that are actually analyzed). Finally, <code>Rscale="cov0"</code> (or <code>Rscale=3</code>) only rescales with \((R - \min(R))\) (which ensures that a phylogenetic covariance matrix is rooted at the lowest split).</p>
<p>See <code><a href='dat.moura2021.html'>dat.moura2021</a></code> and <code><a href='dat.lim2014.html'>dat.lim2014</a></code> for examples of meta-analyses with phylogenetic correlation structures.</p>
<p>Together with the variance-covariance matrix of the sampling errors (i.e., \(V\)), the specified random effects structure of the model implies a particular marginal variance-covariance matrix of the observed effect sizes or outcomes. Once estimates of the variance components (i.e., \(\sigma^2\), \(\tau^2\), \(\rho\), \(\gamma^2\), and/or \(\phi\), values) have been obtained (either using maximum likelihood or restricted maximum likelihood estimation), the estimated marginal variance-covariance matrix can be constructed (denoted by \(M\)). The model coefficients (i.e., \(\beta\)) are then estimated with \(b = (X'WX')^{-1} X'Wy\), where \(W = M^{-1}\) is the weight matrix. With the <code>W</code> argument, one can again specify user-defined weights (or a weight matrix).</p>
<p><b>Fixing Variance Components and/or Correlations</b></p>
<p>Arguments <code>sigma2</code>, <code>tau2</code>, <code>rho</code>, <code>gamma2</code>, and <code>phi</code> can be used to fix particular variance components and/or correlations at a given value. This is useful for sensitivity analyses (e.g., for plotting the regular/restricted log-likelihood as a function of a particular variance component or correlation) or for imposing a desired variance-covariance structure on the data.</p>
<p>For example, if <code>random = list(~ 1 | id1, ~ 1 | id2)</code>, then <code>sigma2</code> must be of length 2 (corresponding to \(\sigma^2_1\) and \(\sigma^2_2\)) and a fixed value can be assigned to either or both variance components. Setting a particular component to <code>NA</code> means that the component will be estimated by the function (e.g., <code>sigma2=c(0,NA)</code> would fix \(\sigma^2_1\) to 0 and estimate \(\sigma^2_2\)).</p>
<p>Argument <code>tau2</code> is only relevant when the <code>random</code> argument contains an <code>~ inner | outer</code> formula. In that case, if the <code>tau2</code> argument is used, it must be either of length 1 (for <code>"CS"</code>, <code>"ID"</code>, <code>"AR"</code>, <code>"CAR"</code>, or one of the spatial correlation structures) or of the same length as the number of levels of the inner factor (for <code>"HCS"</code>, <code>"DIAG"</code>, <code>"UN"</code>, or <code>"HAR"</code>). A numeric value in the <code>tau2</code> argument then fixes the corresponding variance component to that value, while <code>NA</code> means that the component will be estimated. Similarly, if argument <code>rho</code> is used, it must be either of length 1 (for <code>"CS"</code>, <code>"HCS"</code>, <code>"AR"</code>, <code>"HAR"</code>, or one of the spatial correlation structures) or of length \(lvls(lvls-1)/2\) (for <code>"UN"</code>), where \(lvls\) denotes the number of levels of the inner factor. Again, a numeric value fixes the corresponding correlation, while <code>NA</code> means that the correlation will be estimated. For example, with <code>struct="CS"</code> and <code>rho=0</code>, the variance-covariance matrix of the inner factor will be diagonal with \(\tau^2\) along the diagonal. For <code>struct="UN"</code>, the values specified under <code>rho</code> should be given in column-wise order (e.g., for an <code>inner</code> grouping variable/factor with four levels, the order would be \(\rho_{12}\), \(\rho_{13}\), \(\rho_{23}\), \(\rho_{14}\), \(\rho_{24}\), \(\rho_{34}\).</p>
<p>Similarly, arguments <code>gamma2</code> and <code>phi</code> are only relevant when the <code>random</code> argument contains a second <code>~ inner | outer</code> formula. The arguments then work exactly as described above.</p>
<p><b>Omnibus Test of Moderators</b></p>
<p>For models including moderators, an omnibus test of all model coefficients is conducted that excludes the intercept (the first coefficient) if it is included in the model. If no intercept is included in the model, then the omnibus test includes all of the coefficients in the model including the first. Alternatively, one can manually specify the indices of the coefficients to test via the <code>btt</code> argument. For example, with <code>btt=c(3,4)</code>, only the third and fourth coefficient from the model would be included in the test (if an intercept is included in the model, then it corresponds to the first coefficient in the model). Instead of specifying the coefficient numbers, one can specify a string for <code>btt</code>. In that case, <code><a href='https://rdrr.io/r/base/grep.html'>grep</a></code> will be used to search for all coefficient names that match the string. The omnibus test is called the \(Q_M\)-test and follows, under the assumptions of the model, a chi-square distribution with \(m\) degrees of freedom (with \(m\) denoting the number of coefficients tested) under the null hypothesis (that the true value of all coefficients tested is equal to 0).</p>
<p><b>Categorical Moderators</b></p>
<p>Categorical moderator variables can be included in the model via the <code>mods</code> argument in the same way that appropriately (dummy) coded categorical independent variables can be included in linear models. One can either do the dummy coding manually or use a model formula together with the <code><a href='https://rdrr.io/r/base/factor.html'>factor</a></code> function to let <span style="R">R</span> handle the coding automatically (note that string/character variables in a model formula are automatically converted to factors).</p>
<p><b>Tests and Confidence Intervals</b></p>
<p>By default, tests of individual coefficients in the model (and the corresponding confidence intervals) are based on a standard normal distribution, while the omnibus test is based on a chi-square distribution (see above). As an alternative, one can set <code>test="t"</code>, in which case tests of individual coefficients and confidence intervals are based on a t-distribution with \(k-p\) degrees of freedom, while the omnibus test statistic then uses an F-distribution with \(m\) and \(k-p\) degrees of freedom (with \(k\) denoting the total number of estimates included in the analysis and \(p\) the total number of model coefficients including the intercept if it is present). Note that <code>test="t"</code> is not the same as <code>test="knha"</code> in <code><a href='rma.uni.html'>rma.uni</a></code>, as no adjustment to the standard errors of the estimated coefficients is made.</p>
<p>The method for calculating the (denominator) degrees of freedom described above (which corresponds to <code>dfs="residual"</code>) is quite simplistic and may lead to tests with inflated Type I error rates and confidence intervals that are too narrow on average. As an alternative, one can set <code>dfs="contain"</code>, in which case the degrees of freedom for the test of a particular model coefficient, \(b_j\), are determined by checking whether \(x_j\), the corresponding column of the model matrix \(X\), varies at the level corresponding to a particular random effect in the model. If such a random effect can be found, then the degrees of freedom are set to \(l-p\), where \(l\) denotes the unique number of values/levels that the random effect can take on (i.e., for an <code>~ 1 | id</code> term, the unique number of values/levels of the <code>id</code> variable and for an <code>~ inner | outer</code> term, the unique number of values/levels of the <code>outer</code> variable). If no such random effect can be found, then \(k-p\) is used as the degrees of freedom. For the omnibus F-test, the minimum of the degrees of freedom of all coefficients involved in the test is used as the denominator degrees of freedom. This approach for calculating the degrees of freedom should often lead to tests with better control of the Type I error rate and confidence intervals with closer to nominal coverage rates.</p>
<p>One can also set <code>dfs</code> to a numeric vector with the desired values for the degrees of freedom for testing the model coefficients (e.g., if some other method for determining the degrees of freedom was used).</p>
<p><b>Test for (Residual) Heterogeneity</b></p>
<p>A test for (residual) heterogeneity is automatically carried out by the function. Without moderators in the model, this test is the generalized/weighted least squares extension of Cochran's \(Q\)-test, which tests whether the variability in the observed effect sizes or outcomes is larger than one would expect based on sampling variability (and the given covariances among the sampling errors) alone. A significant test suggests that the true effects/outcomes are heterogeneous. When moderators are included in the model, this is the \(Q_E\)-test for residual heterogeneity, which tests whether the variability in the observed effect sizes or outcomes that is not accounted for by the moderators included in the model is larger than one would expect based on sampling variability (and the given covariances among the sampling errors) alone.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>c("rma.mv","rma")</code>. The object is a list containing the following components:</p>
<dt>beta</dt><dd><p>estimated coefficients of the model.</p></dd>
   <dt>se</dt><dd><p>standard errors of the coefficients.</p></dd>
   <dt>zval</dt><dd><p>test statistics of the coefficients.</p></dd>
   <dt>pval</dt><dd><p>corresponding p-values.</p></dd>
   <dt>ci.lb</dt><dd><p>lower bound of the confidence intervals for the coefficients.</p></dd>
   <dt>ci.ub</dt><dd><p>upper bound of the confidence intervals for the coefficients.</p></dd>
   <dt>vb</dt><dd><p>variance-covariance matrix of the estimated coefficients.</p></dd>
   <dt>sigma2</dt><dd><p>estimated \(\sigma^2\) value(s).</p></dd>
   <dt>tau2</dt><dd><p>estimated \(\tau^2\) value(s).</p></dd>
   <dt>rho</dt><dd><p>estimated \(\rho\) value(s).</p></dd>
   <dt>gamma2</dt><dd><p>estimated \(\gamma^2\) value(s).</p></dd>
   <dt>phi</dt><dd><p>estimated \(\phi\) value(s).</p></dd>
   <dt>k</dt><dd><p>number of observed effect sizes or outcomes included in the analysis.</p></dd>
   <dt>p</dt><dd><p>number of coefficients in the model (including the intercept).</p></dd>
   <dt>m</dt><dd><p>number of coefficients included in the omnibus test of moderators.</p></dd>
   <dt>QE</dt><dd><p>test statistic of the test for (residual) heterogeneity.</p></dd>
   <dt>QEp</dt><dd><p>corresponding p-value.</p></dd>
   <dt>QM</dt><dd><p>test statistic of the omnibus test of moderators.</p></dd>
   <dt>QMp</dt><dd><p>corresponding p-value.</p></dd>
   <dt>int.only</dt><dd><p>logical that indicates whether the model is an intercept-only model.</p></dd>
   <dt>yi, V, X</dt><dd><p>the vector of outcomes, the corresponding variance-covariance matrix of the sampling errors, and the model matrix.</p></dd>
   <dt>M</dt><dd><p>the estimated marginal variance-covariance matrix of the observed effect sizes or outcomes.</p></dd>
   <dt>fit.stats</dt><dd><p>a list with the log-likelihood, deviance, AIC, BIC, and AICc values.</p></dd>
   <dt>...</dt><dd><p>some additional elements/values.</p></dd>

    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    <p>The results of the fitted model are formatted and printed with the <code><a href='print.rma.html'>print.rma.mv</a></code> function. If fit statistics should also be given, use <code><a href='print.rma.html'>summary.rma</a></code> (or use the <code><a href='fitstats.html'>fitstats.rma</a></code> function to extract them). Full versus reduced model comparisons in terms of fit statistics and likelihoods can be obtained with <code><a href='anova.rma.html'>anova.rma</a></code>. Wald-type tests for sets of model coefficients or linear combinations thereof can be obtained with the same function. Tests and confidence intervals based on (cluster) robust methods can be obtained with <code><a href='robust.html'>robust.rma.mv</a></code>.</p>
<p>Predicted/fitted values can be obtained with <code><a href='predict.rma.html'>predict.rma</a></code> and <code><a href='fitted.rma.html'>fitted.rma</a></code>. For best linear unbiased predictions, see <code><a href='ranef.html'>ranef.rma.mv</a></code>.</p>
<p>The <code><a href='residuals.rma.html'>residuals.rma</a></code>, <code><a href='residuals.rma.html'>rstandard.rma.mv</a></code>, and <code><a href='residuals.rma.html'>rstudent.rma.mv</a></code> functions extract raw and standardized residuals. See <code><a href='influence.rma.mv.html'>influence.rma.mv</a></code> for additional case diagnostics (e.g., to determine influential studies). For models with moderators, variance inflation factors can be obtained with <code><a href='vif.html'>vif.rma</a></code>.</p>
<p>Confidence intervals for any variance/correlation parameters in the model can be obtained with <code><a href='confint.rma.html'>confint.rma.mv</a></code>.</p>
<p>For random/mixed-effects models, the <code><a href='profile.rma.html'>profile.rma.mv</a></code> function can be used to obtain a plot of the (restricted) log-likelihood as a function of a specific variance component or correlation parameter of the model. For models with moderators, <code><a href='regplot.html'>regplot.rma</a></code> draws scatter plots / bubble plots, showing the (marginal) relationship between the observed outcomes and a selected moderator from the model.</p>
<p>Other extractor functions include <code><a href='coef.rma.html'>coef.rma</a></code>, <code><a href='vcov.rma.html'>vcov.rma</a></code>, <code><a href='fitstats.html'>logLik.rma</a></code>, <code><a href='fitstats.html'>deviance.rma</a></code>, <code><a href='fitstats.html'>AIC.rma</a></code>, <code><a href='fitstats.html'>BIC.rma</a></code>, <code><a href='influence.rma.mv.html'>hatvalues.rma.mv</a></code>, and <code><a href='weights.rma.html'>weights.rma.mv</a></code>.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Argument <code>V</code> also accepts a list of variance-covariance matrices for the observed effect sizes or outcomes. From the list elements, the full (block diagonal) variance-covariance matrix is then automatically constructed.</p>
<p>Model fitting is done via numerical optimization over the model parameters. By default, <code><a href='https://rdrr.io/r/stats/nlminb.html'>nlminb</a></code> is used for the optimization. One can also chose a different optimizer via the <code>control</code> argument (e.g., <code>control=list(optimizer="optim")</code>). When using <code><a href='https://rdrr.io/r/stats/optim.html'>optim</a></code>, one can set the particular method via the <code>optmethod</code> argument (e.g., <code>control=list(optimizer="optim", optmethod="BFGS")</code>). Besides <code><a href='https://rdrr.io/r/stats/nlminb.html'>nlminb</a></code> and <code><a href='https://rdrr.io/r/stats/optim.html'>optim</a></code>, one can also choose one of the optimizers from the <code>minqa</code> package (i.e., <code><a href='https://rdrr.io/pkg/minqa/man/uobyqa.html'>uobyqa</a></code>, <code><a href='https://rdrr.io/pkg/minqa/man/newuoa.html'>newuoa</a></code>, or <code><a href='https://rdrr.io/pkg/minqa/man/bobyqa.html'>bobyqa</a></code>), one of the (derivative-free) algorithms from the <code><a href='https://rdrr.io/pkg/nloptr/man/nloptr.html'>nloptr</a></code> package, the Newton-type algorithm implemented in <code><a href='https://rdrr.io/r/stats/nlm.html'>nlm</a></code>, the various algorithms implemented in the <code>dfoptim</code> package (<code><a href='https://rdrr.io/pkg/dfoptim/man/hookejeeves.html'>hjk</a></code> for the Hooke-Jeeves, <code><a href='https://rdrr.io/pkg/dfoptim/man/nmkb.html'>nmk</a></code> for the Nelder-Mead, and <code><a href='https://rdrr.io/pkg/dfoptim/man/mads.html'>mads</a></code> for the Mesh Adaptive Direct Searches (MADS) algorithm), the quasi-Newton type optimizer <code><a href='https://rdrr.io/pkg/ucminf/man/ucminf.html'>ucminf</a></code> from the package of the same name, or the parallelized version of the L-BFGS-B algorithm implemented in <code><a href='https://rdrr.io/pkg/optimParallel/man/optimParallel.html'>optimParallel</a></code> from the package of the same name.</p>
<p>The optimizer name must be given as a character string (i.e., in quotes). Additional control parameters can be specified via the <code>control</code> argument (e.g., <code>control=list(iter.max=500, rel.tol=1e-8)</code>). For <code><a href='https://rdrr.io/pkg/nloptr/man/nloptr.html'>nloptr</a></code>, the default is to use the BOBYQA implementation from that package with a relative convergence criterion of <code>1e-8</code> on the function value (i.e., log-likelihood), but this can be changed via the <code>algorithm</code> and <code>ftop_rel</code> arguments (e.g., <code>control=list(optimizer="nloptr", algorithm="NLOPT_LN_SBPLX", ftol_rel=1e-6)</code>). For <code><a href='https://rdrr.io/pkg/optimParallel/man/optimParallel.html'>optimParallel</a></code>, the control argument <code>ncpus</code> can be used to specify the number of cores to use for the parallelization (e.g., <code>control=list(optimizer="optimParallel", ncpus=2)</code>). With <code><a href='https://rdrr.io/r/parallel/detectCores.html'>parallel::detectCores()</a></code>, one can check on the number of available cores on the local machine.</p>
<p>At the moment, the starting values are not chosen in a terribly clever way and could be far off. As a result, the optimizer may be slow to converge or may even get stuck at a local maximum. One can set the starting values manually for the various variance components and correlations in the model via the <code>control</code> argument by specifying the vectors <code>sigma2.init</code>, <code>tau2.init</code>, <code>rho.init</code>, <code>gamma2.init</code>, and/or <code>phi.init</code> as needed. Especially for complex models, it is a good idea to try out different starting values to make sure that the same estimates are obtained.</p>
<p>Information on the progress of the optimization algorithm can be obtained by setting <code>verbose=TRUE</code> (this won't work when using parallelization). Since fitting complex models with many random effects can be computationally expensive, this option is useful to determine how the model fitting is progressing. One can also set <code>verbose</code> to an integer (<code>verbose=2</code> yields even more information and <code>verbose=3</code> also sets <code>option(warn=1)</code> temporarily).</p>
<p>Whether particular variance components and/or correlations are actually identifiable needs to be carefully examined when fitting complex models. The function does some limited checking internally to fix variances and/or correlations at zero when it is clear that insufficient information is available to estimate a particular parameter (e.g., if a particular factor has only a single level, the corresponding variance component cannot be estimated). However, it is strongly advised in general to do post model fitting checks to make sure that the likelihood surface around the ML/REML estimates is not flat for some combination of the parameter estimates (which would imply that the estimates are essentially arbitrary). For example, one can plot the (restricted) log-likelihood as a function of each variance component and correlation in the model to make sure that each profile plot shows a clear peak at the corresponding ML/REML estimates. The <code><a href='profile.rma.html'>profile.rma.mv</a></code> function can be used for this purpose.</p>
<p>Finally, note that the model fitting is not done in a very efficient manner at the moment, which is partly a result of allowing for crossed random effects and correlations across the entire dataset (e.g., when using the <code>R</code> argument). As a result, the function works directly with the entire \(k \times k\) (marginal) variance-covariance matrix of the observed effect sizes or outcomes (instead of working with smaller blocks in a block diagonal structure). As a result, model fitting can be slow for large \(k\). However, when the variance-covariance structure is actually sparse, a lot of speed can be gained by setting <code>sparse=TRUE</code>, in which case sparse matrix objects are used (via the <a href='https://cran.r-project.org/package=Matrix'>Matrix</a> package). Also, when model fitting appears to be slow, setting <code>verbose=TRUE</code> is useful to obtain information on how the model fitting is progressing.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Wolfgang Viechtbauer <a href='mailto:wvb@metafor-project.org'>wvb@metafor-project.org</a> <a href='https://www.metafor-project.org'>https://www.metafor-project.org</a></p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Berkey, C. S., Hoaglin, D. C., Antczak-Bouckoms, A., Mosteller, F., &amp; Colditz, G. A. (1998). Meta-analysis of multiple outcomes by regression with random effects. <em>Statistics in Medicine</em>, <b>17</b>(22), 2537--2550. <a href='https://doi.org/10.1002/(sici)1097-0258(19981130)17:22&lt;2537::aid-sim953&gt;3.0.co;2-c'>https://doi.org/10.1002/(sici)1097-0258(19981130)17:22&lt;2537::aid-sim953&gt;3.0.co;2-c</a></p>
<p>Gleser, L. J., &amp; Olkin, I. (2009). Stochastically dependent effect sizes. In H. Cooper, L. V. Hedges, &amp; J. C. Valentine (Eds.), <em>The handbook of research synthesis and meta-analysis</em> (2nd ed., pp. 357--376). New York: Russell Sage Foundation.</p>
<p>van Houwelingen, H. C., Arends, L. R., &amp; Stijnen, T. (2002). Advanced methods in meta-analysis: Multivariate approach and meta-regression. <em>Statistics in Medicine</em>, <b>21</b>(4), 589--624. <a href='https://doi.org/10.1002/sim.1040'>https://doi.org/10.1002/sim.1040</a></p>
<p>Ishak, K. J., Platt, R. W., Joseph, L., Hanley, J. A., &amp; Caro, J. J. (2007). Meta-analysis of longitudinal studies. <em>Clinical Trials</em>, <b>4</b>(5), 525--539. <a href='https://doi.org/10.1177/1740774507083567'>https://doi.org/10.1177/1740774507083567</a></p>
<p>Kalaian, H. A., &amp; Raudenbush, S. W. (1996). A multivariate mixed linear model for meta-analysis. <em>Psychological Methods</em>, <b>1</b>(3), 227-235. <a href='https://doi.org/10.1037/1082-989X.1.3.227'>https://doi.org/10.1037/1082-989X.1.3.227</a></p>
<p>Konstantopoulos, S. (2011). Fixed effects and variance components estimation in three-level meta-analysis. <em>Research Synthesis Methods</em>, <b>2</b>(1), 61--76. <a href='https://doi.org/10.1002/jrsm.35'>https://doi.org/10.1002/jrsm.35</a></p>
<p>Nakagawa, S., &amp; Santos, E. S. A. (2012). Methodological issues and advances in biological meta-analysis. <em>Evolutionary Ecology</em>, <b>26</b>(5), 1253--1274. <a href='https://doi.org/10.1007/s10682-012-9555-5'>https://doi.org/10.1007/s10682-012-9555-5</a></p>
<p>Pinheiro, J. C., &amp; Bates, D. (2000). <em>Mixed-effects models in S and S-PLUS</em>. New York: Springer.</p>
<p>Steiger, J. H. (1980). Tests for comparing elements of a correlation matrix. <em>Psychological Bulletin</em>, <b>87</b>(2), 245--251. <a href='https://doi.org/10.1037/0033-2909.87.2.245'>https://doi.org/10.1037/0033-2909.87.2.245</a></p>
<p>Salanti, G., Higgins, J. P. T., Ades, A. E., &amp; Ioannidis, J. P. A. (2008). Evaluation of networks of randomized trials. <em>Statistical Methods in Medical Research</em>, <b>17</b>(3), 279--301. <a href='https://doi.org/10.1177/0962280207080643'>https://doi.org/10.1177/0962280207080643</a></p>
<p>Trikalinos, T. A., &amp; Olkin, I. (2012). Meta-analysis of effect sizes reported at multiple time points: A multivariate approach. <em>Clinical Trials</em>, <b>9</b>(5), 610--620. <a href='https://doi.org/10.1177/1740774512453218'>https://doi.org/10.1177/1740774512453218</a></p>
<p>Viechtbauer, W. (2010). Conducting meta-analyses in R with the metafor package. <em>Journal of Statistical Software</em>, <b>36</b>(3), 1--48. <a href='https://doi.org/10.18637/jss.v036.i03'>https://doi.org/10.18637/jss.v036.i03</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='rma.uni.html'>rma.uni</a></code>, <code><a href='rma.mh.html'>rma.mh</a></code>, <code><a href='rma.peto.html'>rma.peto</a></code>, and <code><a href='rma.glmm.html'>rma.glmm</a></code> for other model fitting functions.</p>
<p><code><a href='dat.konstantopoulos2011.html'>dat.konstantopoulos2011</a></code>, <code><a href='dat.hasselblad1998.html'>dat.hasselblad1998</a></code>, <code><a href='dat.begg1989.html'>dat.begg1989</a></code>, <code><a href='dat.berkey1998.html'>dat.berkey1998</a></code>, <code><a href='dat.fine1993.html'>dat.fine1993</a></code>, and <code><a href='dat.ishak2007.html'>dat.ishak2007</a></code> for further examples of the use of the <code>rma.mv</code> function.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>### calculate log odds ratios and corresponding sampling variances</span>
<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='escalc.html'>escalc</a></span><span class='op'>(</span>measure<span class='op'>=</span><span class='st'>"OR"</span>, ai<span class='op'>=</span><span class='va'>tpos</span>, bi<span class='op'>=</span><span class='va'>tneg</span>, ci<span class='op'>=</span><span class='va'>cpos</span>, di<span class='op'>=</span><span class='va'>cneg</span>, data<span class='op'>=</span><span class='va'>dat.bcg</span><span class='op'>)</span>

<span class='co'>### fit random-effects model using rma.uni()</span>
<span class='fu'><a href='rma.uni.html'>rma</a></span><span class='op'>(</span><span class='va'>yi</span>, <span class='va'>vi</span>, data<span class='op'>=</span><span class='va'>dat</span><span class='op'>)</span>
</div><div class='co'>#&gt; 
#&gt; Random-Effects Model (k = 13; tau^2 estimator: REML)
#&gt; 
#&gt; tau^2 (estimated amount of total heterogeneity): 0.3378 (SE = 0.1784)
#&gt; tau (square root of estimated tau^2 value):      0.5812
#&gt; I^2 (total heterogeneity / total variability):   92.07%
#&gt; H^2 (total variability / sampling variability):  12.61
#&gt; 
#&gt; Test for Heterogeneity:
#&gt; Q(df = 12) = 163.1649, p-val &lt; .0001
#&gt; 
#&gt; Model Results:
#&gt; 
#&gt; estimate      se     zval    pval    ci.lb    ci.ub 
#&gt;  -0.7452  0.1860  -4.0057  &lt;.0001  -1.1098  -0.3806  *** 
#&gt; 
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; </div><div class='input'>
<span class='co'>### fit random-effects model using rma.mv()</span>
<span class='co'>### note: sigma^2 in this model is the same as tau^2 from the previous model</span>
<span class='fu'>rma.mv</span><span class='op'>(</span><span class='va'>yi</span>, <span class='va'>vi</span>, random <span class='op'>=</span> <span class='op'>~</span> <span class='fl'>1</span> <span class='op'>|</span> <span class='va'>trial</span>, data<span class='op'>=</span><span class='va'>dat</span><span class='op'>)</span>
</div><div class='co'>#&gt; 
#&gt; Multivariate Meta-Analysis Model (k = 13; method: REML)
#&gt; 
#&gt; Variance Components:
#&gt; 
#&gt;             estim    sqrt  nlvls  fixed  factor 
#&gt; sigma^2    0.3378  0.5812     13     no   trial 
#&gt; 
#&gt; Test for Heterogeneity:
#&gt; Q(df = 12) = 163.1649, p-val &lt; .0001
#&gt; 
#&gt; Model Results:
#&gt; 
#&gt; estimate      se     zval    pval    ci.lb    ci.ub 
#&gt;  -0.7452  0.1860  -4.0057  &lt;.0001  -1.1098  -0.3806  *** 
#&gt; 
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; </div><div class='input'>
<span class='co'>### change data into long format</span>
<span class='va'>dat.long</span> <span class='op'>&lt;-</span> <span class='fu'><a href='to.long.html'>to.long</a></span><span class='op'>(</span>measure<span class='op'>=</span><span class='st'>"OR"</span>, ai<span class='op'>=</span><span class='va'>tpos</span>, bi<span class='op'>=</span><span class='va'>tneg</span>, ci<span class='op'>=</span><span class='va'>cpos</span>, di<span class='op'>=</span><span class='va'>cneg</span>, data<span class='op'>=</span><span class='va'>dat.bcg</span><span class='op'>)</span>

<span class='co'>### set levels of group variable ("exp" = experimental/vaccinated; "con" = control/non-vaccinated)</span>
<span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>dat.long</span><span class='op'>$</span><span class='va'>group</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"exp"</span>, <span class='st'>"con"</span><span class='op'>)</span>

<span class='co'>### set "con" to reference level</span>
<span class='va'>dat.long</span><span class='op'>$</span><span class='va'>group</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/relevel.html'>relevel</a></span><span class='op'>(</span><span class='va'>dat.long</span><span class='op'>$</span><span class='va'>group</span>, ref<span class='op'>=</span><span class='st'>"con"</span><span class='op'>)</span>

<span class='co'>### calculate log odds and corresponding sampling variances</span>
<span class='va'>dat.long</span> <span class='op'>&lt;-</span> <span class='fu'><a href='escalc.html'>escalc</a></span><span class='op'>(</span>measure<span class='op'>=</span><span class='st'>"PLO"</span>, xi<span class='op'>=</span><span class='va'>out1</span>, mi<span class='op'>=</span><span class='va'>out2</span>, data<span class='op'>=</span><span class='va'>dat.long</span><span class='op'>)</span>

<span class='co'>### fit bivariate random-effects model using rma.mv()</span>
<span class='va'>res</span> <span class='op'>&lt;-</span> <span class='fu'>rma.mv</span><span class='op'>(</span><span class='va'>yi</span>, <span class='va'>vi</span>, mods <span class='op'>=</span> <span class='op'>~</span> <span class='va'>group</span>, random <span class='op'>=</span> <span class='op'>~</span> <span class='va'>group</span> <span class='op'>|</span> <span class='va'>study</span>, struct<span class='op'>=</span><span class='st'>"UN"</span>, data<span class='op'>=</span><span class='va'>dat.long</span><span class='op'>)</span>
<span class='va'>res</span>
</div><div class='co'>#&gt; 
#&gt; Multivariate Meta-Analysis Model (k = 26; method: REML)
#&gt; 
#&gt; Variance Components:
#&gt; 
#&gt; outer factor: study (nlvls = 13)
#&gt; inner factor: group (nlvls = 2)
#&gt; 
#&gt;             estim    sqrt  k.lvl  fixed  level 
#&gt; tau^2.1    1.5486  1.2444     13     no    con 
#&gt; tau^2.2    2.6173  1.6178     13     no    exp 
#&gt; 
#&gt;      rho.con  rho.exp    con  exp 
#&gt; con        1   0.9450      -   no 
#&gt; exp   0.9450        1     13    - 
#&gt; 
#&gt; Test for Residual Heterogeneity:
#&gt; QE(df = 24) = 5270.3863, p-val &lt; .0001
#&gt; 
#&gt; Test of Moderators (coefficient 2):
#&gt; QM(df = 1) = 15.5470, p-val &lt; .0001
#&gt; 
#&gt; Model Results:
#&gt; 
#&gt;           estimate      se      zval    pval    ci.lb    ci.ub 
#&gt; intrcpt    -4.8374  0.3528  -13.7113  &lt;.0001  -5.5289  -4.1459  *** 
#&gt; groupexp    0.7414  0.1880    3.9430  &lt;.0001   0.3729   1.1099  *** 
#&gt; 
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Wolfgang Viechtbauer.</p>
</div>

<div class="pkgdown">
  <p>Made with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9001, using <a href="https://preferably.amirmasoudabdol.name/?source=footer">preferably</a> template.</p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


