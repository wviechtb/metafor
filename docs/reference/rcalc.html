<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate the Variance-Covariance of Correlation Coefficients — rcalc • metafor</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate the Variance-Covariance of Correlation Coefficients — rcalc" />
<meta property="og:description" content="The function can be used to calculate the variance-covariance matrix of correlation coefficients computed based on the same sample of subjects. " />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@wviechtb" />
<meta name="twitter:site" content="@wviechtb" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metafor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.5-87</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/metafor-package.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/pkgdown/diagram.html">Diagram</a>
</li>
<li>
  <a href="https://www.jstatsoft.org/index.php/jss/article/view/v036i03/v36i03.pdf">JSS Article (pdf)</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/wviechtb">
    <span class="fas fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/wviechtb/metafor">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate the Variance-Covariance of Correlation Coefficients</h1>
    
    <div class="hidden name"><code>rcalc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function can be used to calculate the variance-covariance matrix of correlation coefficients computed based on the same sample of subjects. <script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script></p>
    </div>

    <pre class="usage"><span class='fu'>rcalc</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>ni</span>, <span class='va'>data</span>, rtoz<span class='op'>=</span><span class='cn'>FALSE</span>, nfun<span class='op'>=</span><span class='st'>"min"</span>, sparse<span class='op'>=</span><span class='cn'>FALSE</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a formula of the form <code>ri ~ var1 + var2 | study</code>. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>ni</th>
      <td><p>vector to specify the sample sizes based on which the correlations were computed.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>data frame containing the variables specified via the formula (and the sample sizes).</p></td>
    </tr>
    <tr>
      <th>rtoz</th>
      <td><p>logical to specify whether to transform the correlations via Fisher's r-to-z transformation (the default is <code>FALSE</code>).</p></td>
    </tr>
    <tr>
      <th>nfun</th>
      <td><p>a character string to specify how the &#8216;common&#8217; sample size within each study should be computed. Possible options are <code>"min"</code> (for the minimum), <code>"harmonic"</code> (for the harmonic mean), or <code>"mean"</code> (for the arithmetic mean). Can also be a function. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>sparse</th>
      <td><p>logical to specify whether the variance-covariance matrix should be returned as a sparse matrix (the default is <code>FALSE</code>).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other arguments.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>A meta-analysis of correlation coefficients may involve multiple correlation coefficients extracted from the same study. When these correlations are computed based on the same sample of subjects, then they are typically not independent. The <code>rcalc</code> function can be used to create a dataset with the correlation coefficients (possibly transformed with Fisher's r-to-z transformation) and the corresponding variance-covariance matrix. The dataset and variance-covariance matrix can then be further meta-analyzed using the <code><a href='rma.mv.html'>rma.mv</a></code> function.</p>
<p>When computing the covariance between two correlation coefficients, we can distinguish two cases. In the first case, one of the variables involved in the two correlation coefficients is the same. For example, in \(r_{12}\) and \(r_{13}\), variable 1 is common to both correlation coefficients. This is sometimes called the (partially) &#8216;overlapping&#8217; case. The covariance between the two correlation coefficients, \(\mbox{Cov}[r_{12}, r_{13}]\), then depends on the degree of correlation between variables 2 and 3 (i.e., \(r_{23}\)).</p>
<p>In the second case, none of the variables are common to both correlation coefficients. For example, this would be the case if we have correlations \(r_{12}\) and \(r_{34}\) based on 4 variables. This sometimes called the &#8216;non-overlapping&#8217; case. The covariance between the two correlation coefficients, \(\mbox{Cov}[r_{12}, r_{34}]\), then depends on \(r_{13}\), \(r_{14}\), \(r_{23}\), and \(r_{24}\).</p>
<p>Equations for these covariances can be found, for example, in Steiger (1980) and Olkin and Finn (1990).</p>
<p>To use the <code>rcalc</code> function, one needs to construct a data frame that contains a study identifier (say <code>study</code>), two variable identifiers (say <code>var1</code> and <code>var2</code>), the corresponding correlation coefficient (say <code>ri</code>), and the sample size based on which the correlation coefficient was computed (say <code>ni</code>). Then the first argument should be a formula of the form <code>ri ~ var1 + var2 | study</code>, argument <code>ni</code> is set equal to the variable name containing the sample sizes, and the data frame containing these variables is specified via the <code>data</code> argument. When using the function for a single study, one can leave out the study identifier from the formula.</p>
<p>When argument <code>rtoz</code> is set to <code>TRUE</code>, then the correlations are transformed with Fisher's r-to-z transformation and the variance-covariance matrix is computed for the transformed values.</p>
<p>In some cases, the sample size may not be identical within a study (e.g., \(r_{12}\) may have been computed based on 120 subjects while \(r_{13}\) was computed based on 118 subjects due to 2 missing values in variable 3). For constructing the variance-covariance matrix, we need to assume a &#8216;common&#8217; sample size for all correlation coefficients within the study. Argument <code>nfun</code> provides some options for how the common sample size should be computed. Possible options are <code>"min"</code> (for using the minimum sample size within a study as the common sample size), <code>"harmonic"</code> (for using the harmonic mean), or <code>"mean"</code> (for using the arithmetic mean). The default is <code>"min"</code>, which is a conservative choice (i.e., it will overestimate the sampling variances of coefficients that were computed based on a sample size that was actually larger than the minimum sample size). One can also specify a function via the <code>nfun</code> argument (which should take a numeric vector as input and return a single value).</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list containing the following components:</p>
<dt>dat</dt><dd><p>a data frame with the study identifier, the two variable identifiers, a variable pair identifier, the correlation coefficients (possibly transformed with Fisher's r-to-z transformation), and the (common) sample sizes.</p></dd>
   <dt>V</dt><dd><p>corresponding variance-covariance matrix (given as a sparse matrix when <code>sparse=TRUE</code>).</p></dd>

   Note that a particular covariance can only be computed when all of the correlation coefficients involved in the covariance equation are included in the dataset. If one or more coefficients needed for the computation are missing, then the resulting covariance will also be missing (i.e., NA).

    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>For raw correlation coefficients, the variance-covariance matrix is computed with \(n-1\) in the denominator (instead of \(n\) as suggested in Steiger, 1980, and Olkin &amp; Finn, 1990). This is more consistent with the usual equation for computing the sampling variance of a correlation coefficient (with \(n-1\) in the denominator).</p>
<p>For raw and r-to-z transformed coefficients, the variance-covariance matrix will only be computed when the (common) sample size for a study is at least 5.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Wolfgang Viechtbauer <a href='mailto:wvb@metafor-project.org'>wvb@metafor-project.org</a> <a href='https://www.metafor-project.org'>https://www.metafor-project.org</a></p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Olkin, I., &amp; Finn, J. D. (1990). Testing correlated correlations. <em>Psychological Bulletin</em>, <b>108</b>(2), 330--333. <a href='https://doi.org/10.1037/0033-2909.108.2.330'>https://doi.org/10.1037/0033-2909.108.2.330</a></p>
<p>Steiger, J. H. (1980). Tests for comparing elements of a correlation matrix. <em>Psychological Bulletin</em>, <b>87</b>(2), 245--251. <a href='https://doi.org/10.1037/0033-2909.87.2.245'>https://doi.org/10.1037/0033-2909.87.2.245</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='rma.mv.html'>rma.mv</a></code>, <code><a href='dat.craft2003.html'>dat.craft2003</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>### copy data into 'dat'</span>
<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat.craft2003</span>

<span class='co'>### construct dataset and var-cov matrix of the correlations</span>
<span class='va'>tmp</span> <span class='op'>&lt;-</span> <span class='fu'>rcalc</span><span class='op'>(</span><span class='va'>ri</span> <span class='op'>~</span> <span class='va'>var1</span> <span class='op'>+</span> <span class='va'>var2</span> <span class='op'>|</span> <span class='va'>study</span>, ni<span class='op'>=</span><span class='va'>ni</span>, data<span class='op'>=</span><span class='va'>dat</span><span class='op'>)</span>
<span class='va'>V</span> <span class='op'>&lt;-</span> <span class='va'>tmp</span><span class='op'>$</span><span class='va'>V</span>
<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>tmp</span><span class='op'>$</span><span class='va'>dat</span>

<span class='co'>### examine data for study 1</span>
<span class='va'>dat</span><span class='op'>[</span><span class='va'>dat</span><span class='op'>$</span><span class='va'>study</span> <span class='op'>==</span> <span class='fl'>1</span>,<span class='op'>]</span>
</div><div class='output co'>#&gt;   study var1 var2 var1.var2    yi  ni
#&gt; 1     1 acog perf acog.perf -0.55 142
#&gt; 2     1 asom perf asom.perf -0.48 142
#&gt; 3     1 conf perf conf.perf  0.66 142
#&gt; 4     1 acog asom acog.asom  0.47 142
#&gt; 5     1 acog conf acog.conf -0.38 142
#&gt; 6     1 asom conf asom.conf -0.46 142</div><div class='input'><span class='va'>V</span><span class='op'>[</span><span class='va'>dat</span><span class='op'>$</span><span class='va'>study</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='va'>dat</span><span class='op'>$</span><span class='va'>study</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>]</span>
</div><div class='output co'>#&gt;               acog.perf     asom.perf     conf.perf     acog.asom    acog.conf
#&gt; acog.perf  0.0034503989  0.0013265149 -0.0005545798 -0.0013967848  0.002501895
#&gt; asom.perf  0.0013265149  0.0042005969 -0.0009521407 -0.0019433591  0.001264856
#&gt; conf.perf -0.0005545798 -0.0009521407  0.0022592011  0.0005791091 -0.001533798
#&gt; acog.asom -0.0013967848 -0.0019433591  0.0005791091  0.0043049419 -0.001802689
#&gt; acog.conf  0.0025018954  0.0012648562 -0.0015337979 -0.0018026891  0.005191854
#&gt; asom.conf  0.0009322372  0.0025160783 -0.0010692460 -0.0012050560  0.001884405
#&gt;               asom.conf
#&gt; acog.perf  0.0009322372
#&gt; asom.perf  0.0025160783
#&gt; conf.perf -0.0010692460
#&gt; acog.asom -0.0012050560
#&gt; acog.conf  0.0018844047
#&gt; asom.conf  0.0044083302</div><div class='input'>
<span class='co'>### examine data for study 6</span>
<span class='va'>dat</span><span class='op'>[</span><span class='va'>dat</span><span class='op'>$</span><span class='va'>study</span> <span class='op'>==</span> <span class='fl'>6</span>,<span class='op'>]</span>
</div><div class='output co'>#&gt;    study var1 var2 var1.var2   yi ni
#&gt; 13     6 acog perf acog.perf 0.44 16
#&gt; 14     6 asom perf asom.perf 0.46 16
#&gt; 15     6 conf perf conf.perf   NA 16
#&gt; 16     6 acog asom acog.asom 0.67 16
#&gt; 17     6 acog conf acog.conf   NA 16
#&gt; 18     6 asom conf asom.conf   NA 16</div><div class='input'><span class='va'>V</span><span class='op'>[</span><span class='va'>dat</span><span class='op'>$</span><span class='va'>study</span> <span class='op'>==</span> <span class='fl'>6</span>, <span class='va'>dat</span><span class='op'>$</span><span class='va'>study</span> <span class='op'>==</span> <span class='fl'>6</span><span class='op'>]</span>
</div><div class='output co'>#&gt;             acog.perf   asom.perf conf.perf   acog.asom acog.conf asom.conf
#&gt; acog.perf 0.043352064 0.025583395        NA 0.009529623        NA        NA
#&gt; asom.perf 0.025583395 0.041438304        NA 0.008459787        NA        NA
#&gt; conf.perf          NA          NA        NA          NA        NA        NA
#&gt; acog.asom 0.009529623 0.008459787        NA 0.020247414        NA        NA
#&gt; acog.conf          NA          NA        NA          NA        NA        NA
#&gt; asom.conf          NA          NA        NA          NA        NA        NA</div><div class='input'>
<span class='co'>### examine data for study 17</span>
<span class='va'>dat</span><span class='op'>[</span><span class='va'>dat</span><span class='op'>$</span><span class='va'>study</span> <span class='op'>==</span> <span class='fl'>17</span>,<span class='op'>]</span>
</div><div class='output co'>#&gt;    study var1 var2 var1.var2    yi ni
#&gt; 25    17 acog perf acog.perf  0.10 45
#&gt; 26    17 asom perf asom.perf  0.31 45
#&gt; 27    17 conf perf conf.perf -0.17 45
#&gt; 28    17 acog asom acog.asom    NA 45
#&gt; 29    17 acog conf acog.conf    NA 45
#&gt; 30    17 asom conf asom.conf    NA 45</div><div class='input'><span class='va'>V</span><span class='op'>[</span><span class='va'>dat</span><span class='op'>$</span><span class='va'>study</span> <span class='op'>==</span> <span class='fl'>17</span>, <span class='va'>dat</span><span class='op'>$</span><span class='va'>study</span> <span class='op'>==</span> <span class='fl'>17</span><span class='op'>]</span>
</div><div class='output co'>#&gt;           acog.perf  asom.perf  conf.perf acog.asom acog.conf asom.conf
#&gt; acog.perf  0.022275         NA         NA        NA        NA        NA
#&gt; asom.perf        NA 0.01856898         NA        NA        NA        NA
#&gt; conf.perf        NA         NA 0.02143262        NA        NA        NA
#&gt; acog.asom        NA         NA         NA        NA        NA        NA
#&gt; acog.conf        NA         NA         NA        NA        NA        NA
#&gt; asom.conf        NA         NA         NA        NA        NA        NA</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Wolfgang Viechtbauer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


