<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Studies on the Effectiveness of Counseling for Smoking Cessation — dat.hasselblad1998 • metafor</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Studies on the Effectiveness of Counseling for Smoking Cessation — dat.hasselblad1998" />

<meta property="og:description" content="Results from 24 studies on the effectiveness of various counseling types for smoking cessation." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metafor</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/metafor-package.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/pkgdown/diagram.html">Diagram</a>
</li>
<li>
  <a href="https://www.jstatsoft.org/index.php/jss/article/view/v036i03/v36i03.pdf">JSS Article (pdf)</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/wviechtb">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/wviechtb/metafor">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Studies on the Effectiveness of Counseling for Smoking Cessation</h1>
    
    <div class="hidden name"><code>dat.hasselblad1998.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Results from 24 studies on the effectiveness of various counseling types for smoking cessation.</p>
    
    </div>

    <pre class="usage"><span class='no'>dat.hasselblad1998</span></pre>
        
    <h2 class="hasAnchor" id="format"><a class="anchor" href="#format"></a>Format</h2>

    <p>The data frame contains the following columns:</p><table class='table'>
<tr><td><b>id</b></td><td><code>numeric</code></td><td>id number for each treatment arm</td></tr>
<tr><td><b>study</b></td><td><code>numeric</code></td><td>study id number</td></tr>
<tr><td><b>authors</b></td><td><code>character</code></td><td>study author(s)</td></tr>
<tr><td><b>year</b></td><td><code>numeric</code></td><td>publication year</td></tr>
<tr><td><b>trt</b></td><td><code>character</code></td><td>intervention group</td></tr>
<tr><td><b>xi</b></td><td><code>numeric</code></td><td>number of individuals abstinent</td></tr>
<tr><td><b>ni</b></td><td><code>numeric</code></td><td>number of individuals in group</td></tr>
</table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The dataset includes the results from 24 studies on the effectiveness of various counseling types for smoking cessation (i.e., self-help, individual counseling, group counseling, and no contact). The dataset indicates the total number of individuals within each study arm and the number that were abstinent from 6 to 12 months. The majority of the studies compared two interventions types against each other, while 2 studies compared three types against each other simultaneously.</p>
<p>The data can be used for a &#8216;network meta-analysis&#8217; (also called &#8216;mixed treatment comparison meta-analysis&#8217;). The code below shows how such an analysis can be conducted using an arm-based and a contrast-based model (see Salanti et al., 2008, for more details).</p>
    
    <h2 class="hasAnchor" id="source"><a class="anchor" href="#source"></a>Source</h2>

    <p>Hasselblad, V. (1998). Meta-analysis of multitreatment studies. <em>Medical Decision Making</em>, <b>18</b>, 37--43.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Gleser, L. J., &amp; Olkin, I. (2009). Stochastically dependent effect sizes. In H. Cooper, L. V. Hedges, &amp; J. C. Valentine (Eds.), <em>The handbook of research synthesis and meta-analysis</em> (2nd ed., pp. 357--376). New York: Russell Sage Foundation.</p>
<p>Salanti, G., Higgins, J. P. T., Ades, A. E., &amp; Ioannidis, J. P. A. (2008). Evaluation of networks of randomized trials. <em>Statistical Methods in Medical Research</em>, <b>17</b>, 279--301.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>### load data</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'>get</span>(<span class='fu'>data</span>(<span class='no'>dat.hasselblad1998</span>))

<span class='co'>### calculate log odds for each study arm</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='escalc.html'>escalc</a></span>(<span class='kw'>measure</span><span class='kw'>=</span><span class='st'>"PLO"</span>, <span class='kw'>xi</span><span class='kw'>=</span><span class='no'>xi</span>, <span class='kw'>ni</span><span class='kw'>=</span><span class='no'>ni</span>, <span class='kw'>add</span><span class='kw'>=</span><span class='fl'>1</span>/<span class='fl'>2</span>, <span class='kw'>to</span><span class='kw'>=</span><span class='st'>"all"</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>)

<span class='co'>### create network graph ('plyr' and 'igraph' packages must be installed)</span></div><span class='co'># NOT RUN {</span>
<span class='fu'>require</span>(<span class='no'>plyr</span>)
<span class='fu'>require</span>(<span class='no'>igraph</span>)
<span class='no'>pairs</span> <span class='kw'>&lt;-</span> <span class='fu'>do.call</span>(<span class='no'>rbind</span>, <span class='fu'>sapply</span>(<span class='fu'>split</span>(<span class='no'>dat</span>$<span class='no'>trt</span>, <span class='no'>dat</span>$<span class='no'>study</span>), <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>t</span>(<span class='fu'>combn</span>(<span class='no'>x</span>,<span class='fl'>2</span>))))
<span class='no'>pairs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/plyr/topics/ddply'>ddply</a></span>(<span class='fu'>data.frame</span>(<span class='no'>pairs</span>), <span class='fu'><a href='http://www.rdocumentation.org/packages/plyr/topics/quoted'>.</a></span>(<span class='no'>X1</span>, <span class='no'>X2</span>), <span class='no'>count</span>)
<span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/igraph/topics/graph_from_edgelist'>graph.edgelist</a></span>(<span class='fu'>as.matrix</span>(<span class='no'>pairs</span>[,<span class='fl'>1</span>:<span class='fl'>2</span>]), <span class='kw'>directed</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
<span class='fu'>plot</span>(<span class='no'>g</span>, <span class='kw'>edge.curved</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>edge.width</span><span class='kw'>=</span><span class='no'>pairs</span>$<span class='no'>freq</span>, <span class='kw'>vertex.label.dist</span><span class='kw'>=</span><span class='fl'>.7</span>,
<span class='kw'>vertex.label</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"Individual\nCounseling"</span>, <span class='st'>"Group\nCounseling"</span>, <span class='st'>"No Contact"</span>, <span class='st'>"Self-Help"</span>))
<span class='co'># }</span><div class='input'>
<span class='co'>### convert trt variable to factor with desired ordering of levels</span>
<span class='no'>dat</span>$<span class='no'>trt</span> <span class='kw'>&lt;-</span> <span class='fu'>factor</span>(<span class='no'>dat</span>$<span class='no'>trt</span>, <span class='kw'>levels</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"no_contact"</span>, <span class='st'>"self_help"</span>, <span class='st'>"ind_counseling"</span>, <span class='st'>"grp_counseling"</span>))

<span class='co'>### add a space before each level (this makes the output a bit more legible)</span>
<span class='fu'>levels</span>(<span class='no'>dat</span>$<span class='no'>trt</span>) <span class='kw'>&lt;-</span> <span class='fu'>paste0</span>(<span class='st'>" "</span>, <span class='fu'>levels</span>(<span class='no'>dat</span>$<span class='no'>trt</span>))

<span class='co'>### network meta-analysis using an arm-based model with fixed study effects</span>
<span class='co'>### by setting rho=1/2, tau^2 reflects the amount of heterogeneity for all treatment comparisons</span>
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rma.mv.html'>rma.mv</a></span>(<span class='no'>yi</span>, <span class='no'>vi</span>, <span class='kw'>mods</span> <span class='kw'>=</span> ~ <span class='fu'>factor</span>(<span class='no'>study</span>) + <span class='no'>trt</span> - <span class='fl'>1</span>,
              <span class='kw'>random</span> <span class='kw'>=</span> ~ <span class='no'>trt</span> <span class='kw'>|</span> <span class='no'>study</span>, <span class='kw'>rho</span><span class='kw'>=</span><span class='fl'>1</span>/<span class='fl'>2</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>btt</span><span class='kw'>=</span><span class='fl'>25</span>:<span class='fl'>27</span>)
<span class='no'>res</span></div><div class='output co'>#&gt; 
#&gt; Multivariate Meta-Analysis Model (k = 50; method: REML)
#&gt; 
#&gt; Variance Components:
#&gt; 
#&gt; outer factor: study (nlvls = 24)
#&gt; inner factor: trt   (nlvls = 4)
#&gt; 
#&gt;             estim    sqrt  fixed 
#&gt; tau^2      0.4324  0.6575     no 
#&gt; rho        0.5000            yes 
#&gt; 
#&gt; Test for Residual Heterogeneity:
#&gt; QE(df = 23) = 202.3334, p-val &lt; .0001
#&gt; 
#&gt; Test of Moderators (coefficients 25:27):
#&gt; QM(df = 3) = 14.2278, p-val = 0.0026
#&gt; 
#&gt; Model Results:
#&gt; 
#&gt;                     estimate      se     zval    pval    ci.lb    ci.ub 
#&gt; factor(study)1       -1.3925  0.5820  -2.3926  0.0167  -2.5333  -0.2518    * 
#&gt; factor(study)2       -2.7302  0.5842  -4.6731  &lt;.0001  -3.8753  -1.5851  *** 
#&gt; factor(study)3       -3.7217  0.6681  -5.5703  &lt;.0001  -5.0312  -2.4121  *** 
#&gt; factor(study)4       -2.2710  0.5829  -3.8958  &lt;.0001  -3.4136  -1.1285  *** 
#&gt; factor(study)5       -2.3914  0.7374  -3.2430  0.0012  -3.8367  -0.9461   ** 
#&gt; factor(study)6       -0.9698  0.6421  -1.5104  0.1309  -2.2284   0.2887      
#&gt; factor(study)7       -2.0855  0.6369  -3.2744  0.0011  -3.3339  -0.8372   ** 
#&gt; factor(study)8       -1.9592  0.6674  -2.9357  0.0033  -3.2672  -0.6512   ** 
#&gt; factor(study)9       -2.3487  0.6032  -3.8936  &lt;.0001  -3.5310  -1.1664  *** 
#&gt; factor(study)10      -1.8062  0.6296  -2.8688  0.0041  -3.0402  -0.5722   ** 
#&gt; factor(study)11      -2.2618  0.5978  -3.7835  0.0002  -3.4334  -1.0901  *** 
#&gt; factor(study)12      -3.5643  0.6139  -5.8058  &lt;.0001  -4.7675  -2.3610  *** 
#&gt; factor(study)13      -2.3454  0.5836  -4.0188  &lt;.0001  -3.4892  -1.2015  *** 
#&gt; factor(study)14      -2.0624  0.6492  -3.1767  0.0015  -3.3348  -0.7899   ** 
#&gt; factor(study)15      -2.4575  0.6868  -3.5781  0.0003  -3.8037  -1.1114  *** 
#&gt; factor(study)16      -2.1438  0.6707  -3.1964  0.0014  -3.4583  -0.8293   ** 
#&gt; factor(study)17      -2.6810  0.6448  -4.1581  &lt;.0001  -3.9447  -1.4173  *** 
#&gt; factor(study)18      -2.4066  0.5964  -4.0353  &lt;.0001  -3.5755  -1.2377  *** 
#&gt; factor(study)19      -1.4441  0.8108  -1.7811  0.0749  -3.0331   0.1450    . 
#&gt; factor(study)20      -2.4041  0.6331  -3.7974  0.0001  -3.6450  -1.1633  *** 
#&gt; factor(study)21      -2.4359  0.5817  -4.1877  &lt;.0001  -3.5760  -1.2958  *** 
#&gt; factor(study)22      -2.8559  0.5991  -4.7667  &lt;.0001  -4.0301  -1.6816  *** 
#&gt; factor(study)23      -2.3268  0.5838  -3.9857  &lt;.0001  -3.4710  -1.1826  *** 
#&gt; factor(study)24      -3.0893  0.5847  -5.2836  &lt;.0001  -4.2353  -1.9433  *** 
#&gt; trt self_help         0.3888  0.3221   1.2070  0.2274  -0.2426   1.0202      
#&gt; trt ind_counseling    0.6864  0.1904   3.6055  0.0003   0.3133   1.0596  *** 
#&gt; trt grp_counseling    0.8438  0.3641   2.3176  0.0205   0.1302   1.5574    * 
#&gt; 
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; </div><div class='input'>
<span class='co'>### all pairwise odds ratios of interventions versus no contact</span>
<span class='fu'>predict</span>(<span class='no'>res</span>, <span class='kw'>newmods</span><span class='kw'>=</span><span class='fu'>cbind</span>(<span class='fu'>matrix</span>(<span class='fl'>0</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>24</span>), <span class='fu'>diag</span>(<span class='fl'>3</span>)),
        <span class='kw'>intercept</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>transf</span><span class='kw'>=</span><span class='no'>exp</span>, <span class='kw'>digits</span><span class='kw'>=</span><span class='fl'>2</span>)</div><div class='output co'>#&gt; 
#&gt;   pred ci.lb ci.ub cr.lb cr.ub 
#&gt; 1 1.48  0.78  2.77  0.35  6.20 
#&gt; 2 1.99  1.37  2.89  0.52  7.60 
#&gt; 3 2.33  1.14  4.75  0.53 10.14 
#&gt; </div><div class='input'>
<span class='co'>### all pairwise odds ratios comparing interventions (ic vs sh, gc vs sh, and gc vs ic)</span>
<span class='fu'>predict</span>(<span class='no'>res</span>, <span class='kw'>newmods</span><span class='kw'>=</span><span class='fu'>cbind</span>(<span class='fu'>matrix</span>(<span class='fl'>0</span>, <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>24</span>), <span class='fu'>rbind</span>(<span class='fu'>c</span>(-<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>0</span>), <span class='fu'>c</span>(-<span class='fl'>1</span>,<span class='fl'>0</span>,<span class='fl'>1</span>), <span class='fu'>c</span>(<span class='fl'>0</span>,-<span class='fl'>1</span>,<span class='fl'>1</span>))),
        <span class='kw'>intercept</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>transf</span><span class='kw'>=</span><span class='no'>exp</span>, <span class='kw'>digits</span><span class='kw'>=</span><span class='fl'>2</span>)</div><div class='output co'>#&gt; 
#&gt;   pred ci.lb ci.ub cr.lb cr.ub 
#&gt; 1 1.35  0.70  2.58  0.32  5.71 
#&gt; 2 1.58  0.72  3.43  0.35  7.10 
#&gt; 3 1.17  0.59  2.30  0.27  5.02 
#&gt; </div><div class='input'>
<span class='co'>### forest plot of ORs of interventions versus no contact</span>
<span class='fu'>dev.new</span>(<span class='kw'>width</span><span class='kw'>=</span><span class='fl'>7</span>, <span class='kw'>height</span><span class='kw'>=</span><span class='fl'>4</span>)
<span class='fu'>par</span>(<span class='kw'>mar</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>5</span>,<span class='fl'>4</span>,<span class='fl'>1</span>,<span class='fl'>2</span>))
<span class='fu'><a href='forest.html'>forest</a></span>(<span class='fu'>c</span>(<span class='fl'>0</span>,<span class='no'>res</span>$<span class='no'>beta</span>[<span class='fl'>25</span>:<span class='fl'>27</span>]), <span class='kw'>sei</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0</span>,<span class='no'>res</span>$<span class='no'>se</span>[<span class='fl'>25</span>:<span class='fl'>27</span>]), <span class='kw'>psize</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>xlim</span><span class='kw'>=</span><span class='fu'>c</span>(-<span class='fl'>3</span>,<span class='fl'>4</span>), <span class='kw'>digits</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>2</span>,<span class='fl'>1</span>), <span class='kw'>efac</span><span class='kw'>=</span><span class='fl'>2</span>,
       <span class='kw'>slab</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"No Contact"</span>, <span class='st'>"Self-Help"</span>, <span class='st'>"Individual Counseling"</span>, <span class='st'>"Group Counseling"</span>),
       <span class='kw'>atransf</span><span class='kw'>=</span><span class='no'>exp</span>, <span class='kw'>at</span><span class='kw'>=</span><span class='fu'>log</span>(<span class='fu'>c</span>(<span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>4</span>, <span class='fl'>8</span>)), <span class='kw'>xlab</span><span class='kw'>=</span><span class='st'>"Odds Ratio for Intervention vs. No Contact"</span>)
<span class='fu'>text</span>(-<span class='fl'>3</span>, <span class='fl'>6</span>, <span class='st'>"Intervention"</span>, <span class='kw'>pos</span><span class='kw'>=</span><span class='fl'>4</span>)
<span class='fu'>text</span>( <span class='fl'>4</span>, <span class='fl'>6</span>, <span class='st'>"Odds Ratio [95% CI]"</span>,  <span class='kw'>pos</span><span class='kw'>=</span><span class='fl'>2</span>)

<span class='co'>### restructure dataset to a contrast-based format</span>
<span class='no'>dat.c</span> <span class='kw'>&lt;-</span> <span class='fu'>lapply</span>(<span class='fu'>split</span>(<span class='no'>dat.hasselblad1998</span>, <span class='no'>dat.hasselblad1998</span>$<span class='no'>study</span>),
                <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>cbind</span>(<span class='no'>x</span>[<span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fu'>nrow</span>(<span class='no'>x</span>)-<span class='fl'>1</span>),], <span class='no'>x</span>[-<span class='fl'>1</span>,<span class='fl'>5</span>:<span class='fl'>7</span>]))
<span class='no'>dat.c</span> <span class='kw'>&lt;-</span> <span class='fu'>do.call</span>(<span class='no'>rbind</span>, <span class='no'>dat.c</span>)
<span class='no'>dat.c</span> <span class='kw'>&lt;-</span> <span class='no'>dat.c</span>[,<span class='fu'>c</span>(<span class='fl'>1</span>:<span class='fl'>5</span>,<span class='fl'>8</span>,<span class='fl'>6</span>:<span class='fl'>7</span>,<span class='fl'>9</span>:<span class='fl'>10</span>)]
<span class='fu'>names</span>(<span class='no'>dat.c</span>)[<span class='fl'>5</span>:<span class='fl'>10</span>] <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"trt1"</span>, <span class='st'>"trt2"</span>, <span class='st'>"ai"</span>, <span class='st'>"n1i"</span>, <span class='st'>"ci"</span>, <span class='st'>"n2i"</span>)
<span class='fu'>rownames</span>(<span class='no'>dat.c</span>) <span class='kw'>&lt;-</span> <span class='fl'>1</span>:<span class='fu'>nrow</span>(<span class='no'>dat.c</span>)
<span class='no'>dat.c</span>$<span class='no'>id</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>:<span class='fu'>nrow</span>(<span class='no'>dat.c</span>)
<span class='no'>dat.c</span></div><div class='output co'>#&gt;    id study            authors year           trt1           trt2 ai  n1i  ci
#&gt; 1   1     1        Reid et al. 1974     no_contact ind_counseling 75  731 363
#&gt; 2   2     2    Cottraux et al. 1983     no_contact ind_counseling  9  140  23
#&gt; 3   3     2    Cottraux et al. 1983     no_contact grp_counseling  9  140  10
#&gt; 4   4     3       Slama et al. 1990     no_contact ind_counseling  2  106   9
#&gt; 5   5     4    Jamrozik et al. 1984     no_contact ind_counseling 58  549 237
#&gt; 6   6     5      Rabkin et al. 1984     no_contact ind_counseling  0   33   9
#&gt; 7   7     6   Decker and Evans 1989      self_help ind_counseling 20   49  16
#&gt; 8   8     7    Richmond et al. 1986     no_contact ind_counseling  3  100  31
#&gt; 9   9     8              Leung 1991     no_contact ind_counseling  1   31  26
#&gt; 10 10     9  Mothersill et al. 1988      self_help ind_counseling 11   78  12
#&gt; 11 11     9  Mothersill et al. 1988      self_help grp_counseling 11   78  29
#&gt; 12 12    10    Langford et al. 1983     no_contact ind_counseling  6   39  17
#&gt; 13 13    11       Gritz et al. 1992     no_contact      self_help 79  702  77
#&gt; 14 14    12    Campbell et al. 1986     no_contact      self_help 18  671  21
#&gt; 15 15    13     Sanders et al. 1989     no_contact ind_counseling 64  642 107
#&gt; 16 16    14    Hilleman et al. 1993 ind_counseling grp_counseling 12   76  20
#&gt; 17 17    15     Gillams et al. 1984 ind_counseling grp_counseling  9   55   3
#&gt; 18 18    16 Mogielnicki et al. 1986      self_help grp_counseling  7   66  32
#&gt; 19 19    17        Page et al. 1986     no_contact ind_counseling  5   62   8
#&gt; 20 20    18    Vetter and Ford 1990     no_contact ind_counseling 20  234  34
#&gt; 21 21    19  Williams and Hall 1988     no_contact grp_counseling  0   20   9
#&gt; 22 22    20    Pallonen et al. 1994     no_contact      self_help  8  116  19
#&gt; 23 23    21     Russell et al. 1983     no_contact ind_counseling 95 1107 143
#&gt; 24 24    22 Stewart and Rosser 1982     no_contact ind_counseling 15  187  36
#&gt; 25 25    23     Russell et al. 1979     no_contact ind_counseling 78  584  73
#&gt; 26 26    24    Kendrick et al. 1995     no_contact ind_counseling 69 1177  54
#&gt;     n2i
#&gt; 1   714
#&gt; 2   140
#&gt; 3   138
#&gt; 4   205
#&gt; 5  1561
#&gt; 6    48
#&gt; 7    43
#&gt; 8    98
#&gt; 9    95
#&gt; 10   85
#&gt; 11  170
#&gt; 12   77
#&gt; 13  694
#&gt; 14  535
#&gt; 15  761
#&gt; 16   74
#&gt; 17   26
#&gt; 18  127
#&gt; 19   90
#&gt; 20  237
#&gt; 21   20
#&gt; 22  149
#&gt; 23 1031
#&gt; 24  504
#&gt; 25  675
#&gt; 26  888</div><div class='input'>
<span class='co'>### calculate log odds ratios for each treatment comparison</span>
<span class='no'>dat.c</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='escalc.html'>escalc</a></span>(<span class='kw'>measure</span><span class='kw'>=</span><span class='st'>"OR"</span>, <span class='kw'>ai</span><span class='kw'>=</span><span class='no'>ai</span>, <span class='kw'>n1i</span><span class='kw'>=</span><span class='no'>n1i</span>, <span class='kw'>ci</span><span class='kw'>=</span><span class='no'>ci</span>, <span class='kw'>n2i</span><span class='kw'>=</span><span class='no'>n2i</span>, <span class='kw'>add</span><span class='kw'>=</span><span class='fl'>1</span>/<span class='fl'>2</span>, <span class='kw'>to</span><span class='kw'>=</span><span class='st'>"all"</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat.c</span>)
<span class='no'>dat.c</span></div><div class='output co'>#&gt;    id study            authors year           trt1           trt2 ai  n1i  ci 
#&gt; 1   1     1        Reid et al. 1974     no_contact ind_counseling 75  731 363 
#&gt; 2   2     2    Cottraux et al. 1983     no_contact ind_counseling  9  140  23 
#&gt; 3   3     2    Cottraux et al. 1983     no_contact grp_counseling  9  140  10 
#&gt; 4   4     3       Slama et al. 1990     no_contact ind_counseling  2  106   9 
#&gt; 5   5     4    Jamrozik et al. 1984     no_contact ind_counseling 58  549 237 
#&gt; 6   6     5      Rabkin et al. 1984     no_contact ind_counseling  0   33   9 
#&gt; 7   7     6   Decker and Evans 1989      self_help ind_counseling 20   49  16 
#&gt; 8   8     7    Richmond et al. 1986     no_contact ind_counseling  3  100  31 
#&gt; 9   9     8              Leung 1991     no_contact ind_counseling  1   31  26 
#&gt; 10 10     9  Mothersill et al. 1988      self_help ind_counseling 11   78  12 
#&gt; 11 11     9  Mothersill et al. 1988      self_help grp_counseling 11   78  29 
#&gt; 12 12    10    Langford et al. 1983     no_contact ind_counseling  6   39  17 
#&gt; 13 13    11       Gritz et al. 1992     no_contact      self_help 79  702  77 
#&gt; 14 14    12    Campbell et al. 1986     no_contact      self_help 18  671  21 
#&gt; 15 15    13     Sanders et al. 1989     no_contact ind_counseling 64  642 107 
#&gt; 16 16    14    Hilleman et al. 1993 ind_counseling grp_counseling 12   76  20 
#&gt; 17 17    15     Gillams et al. 1984 ind_counseling grp_counseling  9   55   3 
#&gt; 18 18    16 Mogielnicki et al. 1986      self_help grp_counseling  7   66  32 
#&gt; 19 19    17        Page et al. 1986     no_contact ind_counseling  5   62   8 
#&gt; 20 20    18    Vetter and Ford 1990     no_contact ind_counseling 20  234  34 
#&gt; 21 21    19  Williams and Hall 1988     no_contact grp_counseling  0   20   9 
#&gt; 22 22    20    Pallonen et al. 1994     no_contact      self_help  8  116  19 
#&gt; 23 23    21     Russell et al. 1983     no_contact ind_counseling 95 1107 143 
#&gt; 24 24    22 Stewart and Rosser 1982     no_contact ind_counseling 15  187  36 
#&gt; 25 25    23     Russell et al. 1979     no_contact ind_counseling 78  584  73 
#&gt; 26 26    24    Kendrick et al. 1995     no_contact ind_counseling 69 1177  54 
#&gt;     n2i      yi     vi 
#&gt; 1   714 -2.1964 0.0204 
#&gt; 2   140 -1.0183 0.1639 
#&gt; 3   138 -0.1232 0.2159 
#&gt; 4   205 -0.7035 0.5199 
#&gt; 5  1561 -0.4098 0.0241 
#&gt; 6    48 -2.7797 2.1604 
#&gt; 7    43  0.1469 0.1796 
#&gt; 8    98 -2.5649 0.3425 
#&gt; 9    95 -2.0481 0.7516 
#&gt; 10   85  0.0018 0.1954 
#&gt; 11  170 -0.2019 0.1427 
#&gt; 12   77 -0.3993 0.2574 
#&gt; 13  694  0.0158 0.0287 
#&gt; 14  535 -0.3894 0.1040 
#&gt; 15  761 -0.3874 0.0281 
#&gt; 16   74 -0.6632 0.1626 
#&gt; 17   26  0.3161 0.4550 
#&gt; 18  127 -0.9932 0.1914 
#&gt; 19   90 -0.0743 0.3290 
#&gt; 20  237 -0.5732 0.0873 
#&gt; 21   20 -3.5225 2.2410 
#&gt; 22  149 -0.6457 0.1858 
#&gt; 23 1031 -0.5379 0.0196 
#&gt; 24  504  0.1427 0.0998 
#&gt; 25  675  0.2394 0.0300 
#&gt; 26  888 -0.0408 0.0348 </div><div class='input'>
<span class='co'>### calculate the variance-covariance matrix of the log odds ratios for multitreatment studies</span>
<span class='co'>### see Gleser &amp; Olkin (2009), equation (19.11), for the covariance equation</span>
<span class='no'>calc.v</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
   <span class='no'>v</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fl'>1</span>/(<span class='no'>x</span>$<span class='no'>ai</span>[<span class='fl'>1</span>]+<span class='fl'>1</span>/<span class='fl'>2</span>) + <span class='fl'>1</span>/(<span class='no'>x</span>$<span class='no'>n1i</span>[<span class='fl'>1</span>] - <span class='no'>x</span>$<span class='no'>ai</span>[<span class='fl'>1</span>] + <span class='fl'>1</span>/<span class='fl'>2</span>), <span class='kw'>nrow</span><span class='kw'>=</span><span class='fu'>nrow</span>(<span class='no'>x</span>), <span class='kw'>ncol</span><span class='kw'>=</span><span class='fu'>nrow</span>(<span class='no'>x</span>))
   <span class='fu'>diag</span>(<span class='no'>v</span>) <span class='kw'>&lt;-</span> <span class='no'>x</span>$<span class='no'>vi</span>
   <span class='no'>v</span>
}
<span class='no'>V</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bldiag.html'>bldiag</a></span>(<span class='fu'>lapply</span>(<span class='fu'>split</span>(<span class='no'>dat.c</span>, <span class='no'>dat.c</span>$<span class='no'>study</span>), <span class='no'>calc.v</span>))

<span class='co'>### convert trt1 and trt2 variables to factors with desired ordering of levels</span>
<span class='no'>lvls</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"no_contact"</span>, <span class='st'>"self_help"</span>, <span class='st'>"ind_counseling"</span>, <span class='st'>"grp_counseling"</span>)
<span class='no'>dat.c</span>$<span class='no'>trt1</span> <span class='kw'>&lt;-</span> <span class='fu'>factor</span>(<span class='no'>dat.c</span>$<span class='no'>trt1</span>, <span class='kw'>levels</span><span class='kw'>=</span><span class='no'>lvls</span>)
<span class='no'>dat.c</span>$<span class='no'>trt2</span> <span class='kw'>&lt;-</span> <span class='fu'>factor</span>(<span class='no'>dat.c</span>$<span class='no'>trt2</span>, <span class='kw'>levels</span><span class='kw'>=</span><span class='no'>lvls</span>)

<span class='co'>### create variables to indicate the contrast examined</span>
<span class='no'>dat.c</span> <span class='kw'>&lt;-</span> <span class='fu'>cbind</span>(<span class='no'>dat.c</span>, <span class='fu'>model.matrix</span>(~ <span class='no'>dat.c</span>$<span class='no'>trt1</span> - <span class='fl'>1</span>) - <span class='fu'>model.matrix</span>(~ <span class='no'>dat.c</span>$<span class='no'>trt2</span> - <span class='fl'>1</span>))
<span class='fu'>names</span>(<span class='no'>dat.c</span>)[(<span class='fu'>ncol</span>(<span class='no'>dat.c</span>)-<span class='fl'>3</span>):<span class='fu'>ncol</span>(<span class='no'>dat.c</span>)] <span class='kw'>&lt;-</span> <span class='no'>lvls</span>

<span class='co'>### network meta-analysis using a contrast-based random-effects model</span>
<span class='co'>### by setting rho=1/2, tau^2 reflects the amount of heterogeneity for all treatment comparisons</span>
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rma.mv.html'>rma.mv</a></span>(<span class='no'>yi</span>, <span class='no'>V</span>, <span class='kw'>mods</span> <span class='kw'>=</span> ~ <span class='no'>self_help</span> + <span class='no'>ind_counseling</span> + <span class='no'>grp_counseling</span> - <span class='fl'>1</span>,
              <span class='kw'>random</span> <span class='kw'>=</span> ~ <span class='fu'>factor</span>(<span class='no'>id</span>) <span class='kw'>|</span> <span class='no'>study</span>, <span class='kw'>rho</span><span class='kw'>=</span><span class='fl'>1</span>/<span class='fl'>2</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat.c</span>)
<span class='no'>res</span></div><div class='output co'>#&gt; 
#&gt; Multivariate Meta-Analysis Model (k = 26; method: REML)
#&gt; 
#&gt; Variance Components:
#&gt; 
#&gt; outer factor: study      (nlvls = 24)
#&gt; inner factor: factor(id) (nlvls = 26)
#&gt; 
#&gt;             estim    sqrt  fixed 
#&gt; tau^2      0.4324  0.6575     no 
#&gt; rho        0.5000            yes 
#&gt; 
#&gt; Test for Residual Heterogeneity:
#&gt; QE(df = 23) = 202.3334, p-val &lt; .0001
#&gt; 
#&gt; Test of Moderators (coefficients 1:3):
#&gt; QM(df = 3) = 14.2278, p-val = 0.0026
#&gt; 
#&gt; Model Results:
#&gt; 
#&gt;                 estimate      se    zval    pval    ci.lb   ci.ub 
#&gt; self_help         0.3888  0.3221  1.2070  0.2274  -0.2426  1.0202      
#&gt; ind_counseling    0.6864  0.1904  3.6055  0.0003   0.3133  1.0596  *** 
#&gt; grp_counseling    0.8438  0.3641  2.3176  0.0205   0.1302  1.5574    * 
#&gt; 
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      
      <li><a href="#format">Format</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#source">Source</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Wolfgang Viechtbauer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

